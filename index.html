<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏£‡πà‡∏≠‡∏¢‡∏™‡∏±‡πà‡∏á‡πÄ‡∏•‡∏¢</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        /* ‡∏ã‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô */
        .page-section { display: none; }
        /* ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å */
        .active-section { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        #map { height: 250px; width: 100%; border-radius: 0.5rem; z-index: 0; }
        
        /* Animation ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Modal */
        @keyframes slideUp {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .animate-slide-up { animation: slideUp 0.3s ease-out; }
    </style>
</head>
<body class="bg-gray-100 font-sans pb-20">

    <header class="bg-green-600 text-white p-4 fixed top-0 w-full z-40 shadow-md">
        <div class="flex justify-between items-center max-w-md mx-auto">
            <h1 class="text-xl font-bold">üç± ‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏£‡πà‡∏≠‡∏¢‡πÇ‡∏†‡∏ä‡∏ô‡∏≤</h1>
            <button onclick="showPage('cart')" class="relative">
                üõí <span id="cart-count" class="bg-red-500 text-xs rounded-full px-2 py-0.5 absolute -top-2 -right-2">0</span>
            </button>
        </div>
    </header>

    <main class="mt-20 max-w-md mx-auto p-4">

        <section id="page-menu" class="page-section active-section">
            <h2 class="text-lg font-bold mb-4">‡πÄ‡∏°‡∏ô‡∏π‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</h2>
            <div id="menu-list" class="space-y-4">
                </div>
        </section>

        <section id="page-cart" class="page-section">
            <h2 class="text-lg font-bold mb-4">‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2>
            <div id="cart-items" class="bg-white p-4 rounded shadow mb-4 space-y-3">
                <p class="text-gray-500 text-center">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</p>
            </div>
            
            <div class="flex justify-between font-bold text-xl mb-6">
                <span>‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span>
                <span id="total-price">0 ‡∏ö‡∏≤‡∏ó</span>
            </div>
            
            <div class="flex gap-2">
                <button onclick="showPage('menu')" class="w-1/2 bg-gray-300 py-2 rounded">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
                <button onclick="goToCheckout()" class="w-1/2 bg-green-600 text-white py-2 rounded">‡πÑ‡∏õ‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô</button>
            </div>
        </section>

        <section id="page-checkout" class="page-section">
            <h2 class="text-lg font-bold mb-4">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏±‡∏î‡∏™‡πà‡∏á & ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h2>
            
            <div class="bg-white p-4 rounded shadow space-y-3 mb-4">
                <input type="text" id="cust-name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤" class="w-full border p-2 rounded">
                <input type="text" id="cust-phone" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå" class="w-full border p-2 rounded">
                <textarea id="cust-address" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà (‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà/‡∏ã‡∏≠‡∏¢)" class="w-full border p-2 rounded"></textarea>
                
                <p class="text-sm text-gray-600">üìå ‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î‡∏à‡∏∏‡∏î‡∏™‡πà‡∏á (‡∏à‡∏¥‡πâ‡∏°‡∏ó‡∏µ‡πà‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡πâ‡∏≤‡∏¢):</p>
                <div id="map"></div>
                <input type="hidden" id="latlong">
            </div>

            <div class="bg-white p-4 rounded shadow mb-4 text-center">
                <p class="font-bold mb-2">‡∏™‡πÅ‡∏Å‡∏ô‡∏à‡πà‡∏≤‡∏¢ QR Code</p>
                <img id="qr-image" src="" class="mx-auto w-40 mb-2">
                <p class="text-green-600 font-bold text-xl" id="final-price-display">0 ‡∏ö‡∏≤‡∏ó</p>
                <p class="text-xs text-gray-500">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏î‡πÅ‡∏à‡πâ‡∏á‡πÇ‡∏≠‡∏ô</p>
            </div>

            <div class="flex gap-2">
                <button onclick="showPage('cart')" class="w-1/2 bg-gray-300 py-2 rounded">‡∏Å‡∏•‡∏±‡∏ö</button>
                <button onclick="confirmOrder()" class="w-1/2 bg-green-600 text-white py-2 rounded">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô</button>
            </div>
        </section>

    </main>

    <div id="option-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex justify-center items-end sm:items-center z-50">
        <div class="bg-white w-full max-w-md rounded-t-xl sm:rounded-xl p-5 shadow-lg animate-slide-up max-h-[90vh] flex flex-col">
            
            <div class="flex justify-between items-center mb-4 border-b pb-2">
                <h3 id="modal-item-name" class="text-xl font-bold text-green-700">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π</h3>
                <button onclick="closeModal()" class="text-gray-500 text-3xl leading-none">&times;</button>
            </div>

            <div id="modal-options" class="flex-1 overflow-y-auto mb-4 pr-2">
                </div>

            <div class="border-t pt-4">
                <div class="flex justify-between items-center mb-3">
                    <span class="text-gray-600">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°</span>
                    <div class="text-2xl font-bold text-green-600" id="modal-total-price">0 ‡∏ö‡∏≤‡∏ó</div>
                </div>
                <button onclick="confirmAddToCart()" class="w-full bg-green-600 text-white py-3 rounded-lg font-bold shadow hover:bg-green-700">
                    ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏™‡πà‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
                </button>
            </div>

        </div>
    </div>

    <script>
        // --- 1. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (Mock Data ‡∏û‡∏£‡πâ‡∏≠‡∏° Options) ---
        const menuDB = [
            { 
                id: 1, 
                name: "‡∏ä‡∏≤‡∏ô‡∏°‡πÑ‡∏ï‡πâ‡∏´‡∏ß‡∏±‡∏ô", 
                price: 40, 
                img: "https://images.unsplash.com/photo-1558160074-4d7d8bdf4256?w=200",
                options: [
                    {
                        type: "radio", // ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å 1 ‡∏Ç‡πâ‡∏≠
                        name: "‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ß‡∏≤‡∏ô (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å 1 ‡∏≠‡∏¢‡πà‡∏≤‡∏á)",
                        choices: [
                            { label: "‡∏´‡∏ß‡∏≤‡∏ô‡∏ô‡πâ‡∏≠‡∏¢‡∏°‡∏≤‡∏Å (30%)", price: 0 },
                            { label: "‡∏´‡∏ß‡∏≤‡∏ô‡∏ô‡πâ‡∏≠‡∏¢ (50%)", price: 0 },
                            { label: "‡∏´‡∏ß‡∏≤‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥ (100%)", price: 0 }, // default
                            { label: "‡∏´‡∏ß‡∏≤‡∏ô‡∏°‡∏≤‡∏Å (125%)", price: 0 }
                        ]
                    },
                    {
                        type: "checkbox", // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏Ç‡πâ‡∏≠
                        name: "‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏¥‡πÄ‡∏®‡∏© (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 2 ‡∏≠‡∏¢‡πà‡∏≤‡∏á)",
                        max: 2, 
                        choices: [
                            { label: "‡πÑ‡∏Ç‡πà‡∏°‡∏∏‡∏Å", price: 5 },
                            { label: "‡∏ß‡∏¥‡∏õ‡∏Ñ‡∏£‡∏µ‡∏°", price: 10 },
                            { label: "‡πÄ‡∏â‡∏≤‡∏Å‡πä‡∏ß‡∏¢", price: 5 }
                        ]
                    }
                ]
            },
            { 
                id: 2, 
                name: "‡πÇ‡∏Å‡πÇ‡∏Å‡πâ‡∏õ‡∏±‡πà‡∏ô‡πÄ‡∏Ç‡πâ‡∏°‡∏Ç‡πâ‡∏ô", 
                price: 55, 
                img: "https://images.unsplash.com/photo-1541167760496-1628856ab772?w=200",
                options: [
                    {
                        type: "radio",
                        name: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ß‡∏≤‡∏ô",
                        choices: [
                            { label: "‡∏´‡∏ß‡∏≤‡∏ô‡∏ô‡πâ‡∏≠‡∏¢", price: 0 },
                            { label: "‡∏´‡∏ß‡∏≤‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥", price: 0 }
                        ]
                    },
                    {
                        type: "checkbox",
                        name: "Topping",
                        max: 2,
                        choices: [
                            { label: "‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏õ‡∏±‡πà‡∏ô‡πÄ‡∏Ç‡πâ‡∏°‡∏Ç‡πâ‡∏ô", price: 15 },
                            { label: "‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡πÄ‡∏Ñ‡∏µ‡πâ‡∏¢‡∏ß‡πÄ‡∏û‡∏•‡∏¥‡∏ô‡πÜ", price: 15 }
                        ]
                    }
                ] 
            },
            { 
                id: 3, 
                name: "‡∏Ç‡πâ‡∏≤‡∏ß‡∏°‡∏±‡∏ô‡πÑ‡∏Å‡πà‡∏ï‡∏≠‡∏ô (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å)", 
                price: 50, 
                img: "https://images.unsplash.com/photo-1602169622262-430932795455?w=200"
                // ‡πÑ‡∏°‡πà‡∏°‡∏µ options
            },
            {
                id: 4,
                name: "‡∏Ç‡πâ‡∏≤‡∏ß‡∏¢‡∏≥‡πÑ‡∏Å‡πà‡πÅ‡∏ã‡πà‡∏ö",
                price: 60,
                img: "https://images.unsplash.com/photo-1596797038530-2c107229654b?w=200",
                options: [
                    {
                        type: "radio",
                        name: "‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ú‡πá‡∏î",
                        choices: [
                            { label: "‡πÄ‡∏ú‡πá‡∏î‡∏ô‡πâ‡∏≠‡∏¢", price: 0 },
                            { label: "‡πÄ‡∏ú‡πá‡∏î‡∏õ‡∏Å‡∏ï‡∏¥", price: 0 },
                            { label: "‡πÄ‡∏ú‡πá‡∏î‡∏õ‡∏≤‡∏Å‡πÄ‡∏ö‡∏¥‡∏£‡πå‡∏ô", price: 0 }
                        ]
                    }
                ]
            }
        ];

        let cart = []; 
        let map, marker;
        
        // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Modal
        let currentItem = null;
        let currentBasePrice = 0;

        // --- 2. ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô ---
        document.addEventListener("DOMContentLoaded", () => {
            renderMenu();
            initMap();
        });

        // --- 3. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏ô‡πâ‡∏≤ ---
        function showPage(pageId) {
            document.querySelectorAll('.page-section').forEach(el => el.classList.remove('active-section'));
            document.getElementById('page-' + pageId).classList.add('active-section');
            if(pageId === 'checkout') {
                setTimeout(() => { map.invalidateSize(); }, 200);
            }
        }

        // --- 4. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏ô‡∏π ---
        function renderMenu() {
            const list = document.getElementById('menu-list');
            list.innerHTML = menuDB.map(item => `
                <div class="bg-white p-3 rounded shadow flex gap-4 items-center">
                    <img src="${item.img}" class="w-20 h-20 object-cover rounded shadow-sm">
                    <div class="flex-1">
                        <h3 class="font-bold text-lg">${item.name}</h3>
                        <p class="text-green-600 font-bold">${item.price} ‡∏ö‡∏≤‡∏ó</p>
                    </div>
                    <button onclick="addToCart(${item.id})" class="bg-green-100 text-green-700 px-4 py-2 rounded-lg font-bold hover:bg-green-200 transition">
                        ${item.options ? '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å' : '‡πÄ‡∏û‡∏¥‡πà‡∏°'}
                    </button>
                </div>
            `).join('');
        }

        // --- 5. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Modal & Add to Cart ---
        function addToCart(id) {
            const item = menuDB.find(p => p.id === id);
            
            // ‡∏Å‡∏£‡∏ì‡∏µ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å -> ‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡πÄ‡∏•‡∏¢
            if (!item.options || item.options.length === 0) {
                pushToCart(item, [], item.price);
                return;
            }

            // ‡∏Å‡∏£‡∏ì‡∏µ‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å -> ‡πÄ‡∏õ‡∏¥‡∏î Modal
            openModal(item);
        }

        function openModal(item) {
            currentItem = item;
            currentBasePrice = item.price;
            
            document.getElementById('modal-item-name').innerText = item.name;
            const container = document.getElementById('modal-options');
            container.innerHTML = ''; 

            item.options.forEach((opt, idx) => {
                let html = `<div class="mb-4">
                    <p class="font-bold mb-2 text-gray-700 border-l-4 border-green-500 pl-2">${opt.name}</p>
                    <div class="space-y-2">`;
                
                if (opt.type === 'radio') {
                    // Radio buttons
                    opt.choices.forEach((choice, cIdx) => {
                        const isChecked = cIdx === 2 ? 'checked' : ''; // (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á) ‡πÉ‡∏´‡πâ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà 3 ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏≠‡∏≤‡∏≠‡∏≠‡∏Å‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
                        html += `
                            <label class="flex items-center p-2 border rounded hover:bg-gray-50 cursor-pointer">
                                <input type="radio" name="opt-${idx}" value="${choice.label}" data-price="${choice.price}" ${isChecked} class="option-input h-4 w-4 text-green-600 focus:ring-green-500" onchange="calculateModalTotal()">
                                <span class="ml-2 flex-1">${choice.label}</span>
                                ${choice.price > 0 ? `<span class="text-green-600">+${choice.price}</span>` : ''}
                            </label>
                        `;
                    });
                } else if (opt.type === 'checkbox') {
                    // Checkboxes
                    opt.choices.forEach((choice) => {
                        html += `
                            <label class="flex items-center p-2 border rounded hover:bg-gray-50 cursor-pointer">
                                <input type="checkbox" name="opt-${idx}" value="${choice.label}" data-price="${choice.price}" class="option-input h-4 w-4 text-green-600 rounded focus:ring-green-500" onchange="checkLimit(this, ${opt.max}); calculateModalTotal()">
                                <span class="ml-2 flex-1">${choice.label}</span>
                                ${choice.price > 0 ? `<span class="text-green-600">+${choice.price}</span>` : ''}
                            </label>
                        `;
                    });
                    if(opt.max) html += `<p class="text-xs text-gray-400 mt-1 pl-1">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô ${opt.max} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>`;
                }
                
                html += `</div></div>`;
                container.innerHTML += html;
            });

            calculateModalTotal();
            document.getElementById('option-modal').classList.remove('hidden');
        }

        function calculateModalTotal() {
            let total = currentBasePrice;
            document.querySelectorAll('.option-input:checked').forEach(input => {
                total += parseInt(input.getAttribute('data-price') || 0);
            });
            document.getElementById('modal-total-price').innerText = total + " ‡∏ö‡∏≤‡∏ó";
        }

        function checkLimit(checkbox, max) {
            if (!max) return;
            const name = checkbox.name;
            const checkedCount = document.querySelectorAll(`input[name="${name}"]:checked`).length;
            if (checkedCount > max) {
                checkbox.checked = false;
                Swal.fire({ 
                    toast: true, position: 'center', icon: 'warning', 
                    title: `‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î ${max} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`, showConfirmButton: false, timer: 1500 
                });
            }
        }

        function closeModal() {
            document.getElementById('option-modal').classList.add('hidden');
        }

        function confirmAddToCart() {
            const selectedOptions = [];
            let totalPrice = currentBasePrice;
            let allRequiredSelected = true;

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Radio (Required)
            currentItem.options.forEach((opt, idx) => {
                if (opt.type === 'radio') {
                    if (!document.querySelector(`input[name="opt-${idx}"]:checked`)) {
                        allRequiredSelected = false;
                    }
                }
            });

            if (!allRequiredSelected) {
                Swal.fire({ icon: 'error', title: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô' });
                return;
            }

            // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
            document.querySelectorAll('.option-input:checked').forEach(input => {
                selectedOptions.push(input.value);
                totalPrice += parseInt(input.getAttribute('data-price') || 0);
            });

            pushToCart(currentItem, selectedOptions, totalPrice);
            closeModal();
        }

        function pushToCart(item, options, finalPrice) {
            cart.push({
                ...item, // copy item props
                selectedOptions: options,
                finalPrice: finalPrice
            });
            updateCartUI();
            
            Swal.fire({
                icon: 'success',
                title: '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß',
                showConfirmButton: false,
                timer: 800
            });
        }

        // --- 6. ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ---
        function updateCartUI() {
            document.getElementById('cart-count').innerText = cart.length;

            const total = cart.reduce((sum, item) => sum + item.finalPrice, 0);
            document.getElementById('total-price').innerText = total + " ‡∏ö‡∏≤‡∏ó";

            const cartList = document.getElementById('cart-items');
            if(cart.length === 0) {
                cartList.innerHTML = '<p class="text-gray-500 text-center py-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</p>';
                return;
            }
            
            cartList.innerHTML = cart.map((item, index) => `
                <div class="flex justify-between items-start border-b pb-2 last:border-0">
                    <div class="flex-1">
                        <span class="font-bold text-gray-800">${item.name}</span>
                        ${item.selectedOptions && item.selectedOptions.length > 0 
                          ? `<p class="text-xs text-gray-500 mt-1">‚ûï ${item.selectedOptions.join(', ')}</p>` 
                          : ''}
                    </div>
                    <div class="flex flex-col items-end gap-1">
                        <span class="font-bold">${item.finalPrice} ‡∏ö.</span>
                        <button onclick="removeFromCart(${index})" class="text-red-500 text-xs hover:underline">‡∏•‡∏ö</button>
                    </div>
                </div>
            `).join('');
        }

        function removeFromCart(index) {
            cart.splice(index, 1);
            updateCartUI();
        }

        function goToCheckout() {
            if(cart.length === 0) return Swal.fire('‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤');
            
            const total = cart.reduce((sum, item) => sum + item.finalPrice, 0);
            const phone = "0812345678"; // ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏û‡∏¢‡πå‡∏£‡πâ‡∏≤‡∏ô
            
            document.getElementById('qr-image').src = `https://promptpay.io/${phone}/${total}`;
            document.getElementById('final-price-display').innerText = total + " ‡∏ö‡∏≤‡∏ó";
            
            showPage('checkout');
        }

        // --- 7. ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà (Update ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà + Click to Move) ---
        function initMap() {
            // ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
            const defaultLoc = [13.639484, 100.500646];
            
            map = L.map('map').setView(defaultLoc, 16);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; OpenStreetMap contributors'
            }).addTo(map);
            
            marker = L.marker(defaultLoc).addTo(map);
            document.getElementById('latlong').value = `${defaultLoc[0]},${defaultLoc[1]}`;

            // ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡πâ‡∏≤‡∏¢‡∏´‡∏°‡∏∏‡∏î
            map.on('click', function(e) {
                const coord = e.latlng;
                marker.setLatLng(coord);
                document.getElementById('latlong').value = `${coord.lat},${coord.lng}`;
                map.panTo(coord); // ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏à‡∏≠‡∏ï‡∏≤‡∏°‡∏´‡∏°‡∏∏‡∏î
            });
        }

        // --- 8. ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ ---
        function confirmOrder() {
            const name = document.getElementById('cust-name').value;
            const phone = document.getElementById('cust-phone').value;
            
            if(!name || !phone) return Swal.fire('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£');

            Swal.fire({
                title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...',
                didOpen: () => Swal.showLoading()
            });

            // ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
            setTimeout(() => {
                Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', '‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success').then(() => {
                    location.reload(); 
                });
            }, 1500);

            /* // ‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Apps Script
               const payload = {
                   name, phone, 
                   address: document.getElementById('cust-address').value,
                   location: document.getElementById('latlong').value,
                   items: cart.map(i => `${i.name} (${i.selectedOptions.join(',')})`).join('\n'),
                   total: cart.reduce((s, i) => s + i.finalPrice, 0)
               };
               // fetch(...)
            */
        }
    </script>
</body>
</html>
