<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏´‡∏ô‡∏∏‡πà‡∏°‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô ‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏õ‡∏±‡πà‡∏ô</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600&display=swap');
        
        body { 
            font-family: 'Prompt', sans-serif; 
            background-color: #f8f9fa;
            color: #333;
            -webkit-font-smoothing: antialiased;
        }
        
        .page-section { display: none; }
        .active-section { display: block; animation: fadeIn 0.4s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        
        #map { height: 300px; width: 100%; border-radius: 12px; z-index: 0; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .tab-active { color: #16a34a; border-bottom: 2px solid #16a34a; background-color: rgba(22, 163, 74, 0.05); }
        .tab-inactive { color: #6b7280; border-bottom: 2px solid transparent; }
        .payment-radio:checked + div { border-color: #16a34a; background-color: #f0fdf4; }
        .payment-radio:checked + div .radio-indicator { border-color: #16a34a; background-color: #16a34a; box-shadow: inset 0 0 0 3px white; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="pb-32"> 

    <div class="max-w-md mx-auto min-h-screen bg-white shadow-xl relative overflow-hidden sm:border-x sm:border-gray-100">

        <header class="bg-white sticky top-0 z-30 shadow-sm/50 backdrop-blur-md bg-opacity-95">
            <div class="px-5 py-4 flex items-center gap-4">
                <button onclick="goBack()" class="w-10 h-10 rounded-full bg-gray-50 text-gray-600 flex items-center justify-center hover:bg-gray-100 transition shadow-sm">
                    <i class="fa-solid fa-arrow-left"></i>
                </button>
                
                <div class="flex-1">
                    <h1 class="font-semibold text-xl text-gray-800 tracking-tight">‡∏´‡∏ô‡∏∏‡πà‡∏°‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô ‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏õ‡∏±‡πà‡∏ô</h1>
                    
                    <div class="flex items-center gap-1 text-xs text-green-600 font-medium mb-1">
                        <i class="fa-solid fa-location-dot"></i>
                        <span id="header-distance">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏™‡πà‡∏á</span>
                    </div>

                    <div class="flex flex-wrap items-center gap-x-3 gap-y-1 text-xs text-gray-500">
                        <div class="flex items-center gap-1">
                            <i class="fa-regular fa-clock text-green-600"></i>
                            <span>09:00 - 20:00 ‡∏ô.</span>
                        </div>
                        <div class="flex items-center gap-1">
                            <i class="fa-solid fa-phone text-green-600"></i>
                            <a href="tel:0622467746" class="hover:text-green-700 hover:underline">062-246-7746</a>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="category-tabs" class="flex px-2 border-b border-gray-100">
                <div onclick="switchTab('recommend')" id="tab-recommend" class="flex-1 text-center py-3 text-sm font-medium cursor-pointer transition-all tab-active">‡∏î‡∏π‡πÄ‡∏°‡∏ô‡∏π</div>
                <div onclick="switchTab('promotion')" id="tab-promotion" class="flex-1 text-center py-3 text-sm font-medium cursor-pointer transition-all tab-inactive">‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô</div>
            </div>
        </header>

        <section id="page-menu" class="page-section active-section">
            <div class="mt-4 px-5">
                <div id="banner-slider" class="flex overflow-x-auto snap-x snap-mandatory gap-3 no-scrollbar rounded-2xl" style="scroll-behavior: smooth;">
                    <div class="snap-center shrink-0 w-full h-40 relative rounded-2xl overflow-hidden shadow-md">
                        <img src="https://lh3.googleusercontent.com/d/1LHnoa4svvYWmUIiNUSd5uzK5OWeH00sm" class="w-full h-full object-cover">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent"></div>
                        <div class="absolute bottom-3 left-4 text-white">
                        
                        </div>
                    </div>
            
                    <div class="snap-center shrink-0 w-full h-40 relative rounded-2xl overflow-hidden shadow-md">
                        <img src="https://lh3.googleusercontent.com/d/1ETSCcbns33VmVDTd2bq46Re5WG9pwTZA" class="w-full h-full object-cover">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent"></div>
                        <div class="absolute bottom-3 left-4 text-white">
                            
                        </div>
                    </div>
            
                </div>
            </div>
            <div class="px-5 py-4 bg-gray-50 border-b border-gray-100 flex justify-between items-end">
                <h2 id="menu-heading" class="font-semibold text-lg text-gray-700">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏≠‡∏î‡∏Æ‡∏¥‡∏ï üî•</h2>
            </div>
            <div id="menu-list" class="pb-4"></div>
        </section>

        <section id="page-cart" class="page-section bg-gray-50 min-h-screen">
            <div class="bg-white px-5 py-4 shadow-sm mb-2">
                <h2 class="text-xl font-semibold text-gray-800">‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2>
            </div>
            <div id="cart-items" class="bg-white p-5 mb-3 space-y-4"></div>
            <div class="bg-white p-5 space-y-3">
                <div class="flex justify-between font-semibold text-xl text-gray-800">
                    <span>‡∏Ñ‡πà‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</span>
                    <span id="total-price-cart">0 ‡∏ö‡∏≤‡∏ó</span>
                </div>
                <p class="text-xs text-gray-400">*‡∏Ñ‡πà‡∏≤‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏à‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÉ‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</p>
            </div>
        </section>

        <section id="page-address" class="page-section bg-white min-h-screen px-5 py-6">
            <h2 class="text-xl font-semibold mb-2 text-gray-800">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</h2>
            <p class="text-sm text-gray-500 mb-6">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏á</p>
            
            <div class="space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-medium text-gray-700 mb-1">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö</label>
                        <input type="text" id="cust-name" class="w-full bg-gray-50 border border-gray-200 rounded-lg px-4 py-3 focus:ring-1 focus:ring-green-500 outline-none" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô">
                    </div>
                    <div>
                        <label class="block text-xs font-medium text-gray-700 mb-1">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</label>
                        <input type="tel" id="cust-phone" class="w-full bg-gray-50 border border-gray-200 rounded-lg px-4 py-3 focus:ring-1 focus:ring-green-500 outline-none" placeholder="08x-xxx-xxxx">
                    </div>
                </div>
                <div>
                    <label class="block text-xs font-medium text-gray-700 mb-1">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà (‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà/‡∏ã‡∏≠‡∏¢)</label>
                    <textarea id="cust-address" class="w-full bg-gray-50 border border-gray-200 rounded-lg px-4 py-3 focus:ring-1 focus:ring-green-500 outline-none" rows="2" placeholder="‡πÄ‡∏ä‡πà‡∏ô 123/4 ‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô..."></textarea>
                </div>
                <div>
                    <label class="block text-xs font-medium text-gray-700 mb-1">‡∏à‡∏∏‡∏î‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï (Optional)</label>
                    <input type="text" id="cust-landmark" class="w-full bg-gray-50 border border-gray-200 rounded-lg px-4 py-3 focus:ring-1 focus:ring-green-500 outline-none" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏£‡∏±‡πâ‡∏ß‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß, ‡∏ï‡∏£‡∏á‡∏Ç‡πâ‡∏≤‡∏°‡πÄ‡∏ã‡πÄ‡∏ß‡πà‡∏ô">
                </div>
                <div class="pt-2">
                    <div class="flex justify-between items-center mb-2">
                        <label class="text-sm font-semibold text-gray-700">üìç ‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î‡∏à‡∏∏‡∏î‡∏™‡πà‡∏á</label>
                        <span id="distance-display" class="text-xs font-bold text-gray-400 bg-gray-100 px-2 py-1 rounded">‡πÅ‡∏ï‡∏∞‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</span>
                    </div>
                    <div id="map"></div>
                    <p class="text-xs text-red-500 mt-2 hidden" id="out-of-range-msg"><i class="fa-solid fa-circle-exclamation"></i> ‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢ ‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏≠‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á (‡πÄ‡∏Å‡∏¥‡∏ô 5 ‡∏Å‡∏°.)</p>
                </div>
            </div>
        </section>

        <section id="page-payment" class="page-section bg-gray-50 min-h-screen">
            <div class="bg-white p-5 shadow-sm mb-4">
                <h2 class="text-lg font-bold text-gray-800 mb-4">‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏ä‡∏≥‡∏£‡∏∞</h2>
                <div class="space-y-2 text-sm">
                    <div class="flex justify-between text-gray-600">
                        <span>‡∏Ñ‡πà‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£</span>
                        <span id="summary-food-total">0 ‡∏ö‡∏≤‡∏ó</span>
                    </div>
                    <div class="flex justify-between text-gray-600">
                        <span>‡∏Ñ‡πà‡∏≤‡∏à‡∏±‡∏î‡∏™‡πà‡∏á <span id="delivery-details" class="ml-2"></span></span>
                        <span id="summary-delivery-fee">0 ‡∏ö‡∏≤‡∏ó</span>
                    </div>
                    <div class="border-t border-dashed pt-2 mt-2 flex justify-between text-lg font-bold text-gray-800">
                        <span>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</span>
                        <span id="summary-grand-total" class="text-green-600">0 ‡∏ö‡∏≤‡∏ó</span>
                    </div>
                </div>
            </div>

            <div class="bg-white p-5 shadow-sm">
                <h2 class="text-lg font-bold text-gray-800 mb-4">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h2>
                <label class="block mb-3 cursor-pointer">
                    <input type="radio" name="paymentMethod" value="transfer" class="payment-radio hidden" checked onchange="togglePaymentDetail()">
                    <div class="border rounded-xl p-4 flex items-center justify-between transition-all hover:bg-gray-50">
                        <div class="flex items-center gap-3">
                            <div class="w-5 h-5 rounded-full border border-gray-300 radio-indicator flex items-center justify-center"></div>
                            <span class="font-medium text-gray-700">‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô / ‡∏™‡πÅ‡∏Å‡∏ô‡∏à‡πà‡∏≤‡∏¢</span>
                        </div>
                        <i class="fa-solid fa-qrcode text-gray-400 text-xl"></i>
                    </div>
                </label>
                <div id="payment-transfer-detail" class="ml-2 pl-6 border-l-2 border-gray-200 mb-6 space-y-4">
                    <div class="bg-green-50 p-4 rounded-lg text-center border border-green-100">
                        <p class="text-sm font-bold text-gray-600 mb-2">‡∏™‡πÅ‡∏Å‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡πà‡∏≤‡∏¢</p>
                        <img id="qr-image" src="" class="w-40 h-40 mx-auto bg-white p-2 rounded shadow-sm">
                        <p class="text-xl font-bold text-green-700 mt-2" id="qr-amount-display">0 ‡∏ö‡∏≤‡∏ó</p>
                    </div>
                    <div class="bg-gray-100 p-3 rounded-lg text-sm text-gray-600">
                        <p><strong>‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£:</strong> ‡∏Å‡∏™‡∏¥‡∏Å‡∏£‡πÑ‡∏ó‡∏¢ (K-Bank)</p>
                        <p><strong>‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ:</strong> ‡∏ô‡∏≤‡∏¢‡∏´‡∏ô‡∏∏‡πà‡∏° ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô</p>
                        <p><strong>‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ:</strong> 123-4-56789-0</p>
                    </div>
                    <div>
                        <label class="block text-xs font-medium text-gray-700 mb-1">‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô</label>
                        <input type="file" id="slip-file" accept="image/*" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2.5 file:px-4 file:rounded-l-lg file:border-0 file:text-sm file:font-semibold file:bg-green-600 file:text-white hover:file:bg-green-700 border border-gray-300 rounded-lg cursor-pointer bg-white shadow-sm">
                    </div>
                </div>
                <label class="block cursor-pointer">
                    <input type="radio" name="paymentMethod" value="cod" class="payment-radio hidden" onchange="togglePaymentDetail()">
                    <div class="border rounded-xl p-4 flex items-center justify-between transition-all hover:bg-gray-50">
                        <div class="flex items-center gap-3">
                            <div class="w-5 h-5 rounded-full border border-gray-300 radio-indicator flex items-center justify-center"></div>
                            <span class="font-medium text-gray-700">‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á (COD)</span>
                        </div>
                        <i class="fa-solid fa-money-bill-wave text-gray-400 text-xl"></i>
                    </div>
                </label>
                <div id="payment-cod-detail" class="hidden ml-2 pl-6 border-l-2 border-gray-200 mt-3">
                    <div class="bg-yellow-50 text-yellow-800 p-3 rounded-lg text-sm flex items-start gap-2">
                        <i class="fa-solid fa-circle-info mt-1"></i>
                        <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡πÉ‡∏´‡πâ‡∏û‡∏≠‡∏î‡∏µ‡∏Å‡∏±‡∏ö‡∏¢‡∏≠‡∏î <strong><span id="cod-amount-display"></span></strong> ‡∏ö‡∏≤‡∏ó</p>
                    </div>
                </div>
            </div>
        </section>

        <div id="sticky-footer" class="fixed bottom-0 w-full max-w-md bg-white/95 backdrop-blur shadow-[0_-4px_10px_rgba(0,0,0,0.05)] border-t p-4 z-40 hidden">
            <button id="btn-view-cart" onclick="showPage('cart')" class="w-full bg-green-600 text-white rounded-xl p-3.5 flex justify-between items-center shadow-lg hover:bg-green-700 transition transform active:scale-[0.98]">
                <div class="flex items-center gap-3">
                    <div class="bg-white/20 font-bold w-8 h-8 rounded-lg flex items-center justify-center text-sm" id="footer-count">0</div>
                    <span class="font-semibold">‡∏î‡∏π‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</span>
                </div>
                <span class="font-bold text-lg" id="footer-total">‡∏ø0</span>
            </button>
            <button id="btn-go-address" onclick="showPage('address')" class="hidden w-full bg-green-600 text-white rounded-xl p-3.5 font-bold shadow-lg hover:bg-green-700 transition">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
            <button id="btn-confirm-address" onclick="validateAndGoToPayment()" class="hidden w-full bg-green-600 text-white rounded-xl p-3.5 font-bold shadow-lg hover:bg-green-700 transition disabled:bg-gray-400">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà & ‡πÑ‡∏õ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</button>
            <button id="btn-confirm-order" onclick="confirmOrder()" class="hidden w-full bg-green-600 text-white rounded-xl p-3.5 font-bold shadow-lg hover:bg-green-700 transition">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</button>
        </div>

    </div>

    <div id="option-modal" class="fixed inset-0 bg-black/60 backdrop-blur-sm hidden flex justify-center items-end sm:items-center z-50 transition-opacity">
        <div class="bg-white w-full max-w-md rounded-t-3xl sm:rounded-2xl p-6 shadow-2xl animate-slide-up max-h-[85vh] flex flex-col">
            <div class="flex justify-between items-start mb-4 pb-2 border-b">
                <h3 id="modal-item-name" class="text-xl font-semibold text-gray-800">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π</h3>
                <button onclick="closeModal()" class="text-gray-400 text-2xl">&times;</button>
            </div>
            <div id="modal-options" class="flex-1 overflow-y-auto mb-4 pr-1 space-y-5 custom-scrollbar"></div>
            <div class="pt-2">
                <button onclick="confirmAddToCart()" class="w-full bg-green-600 text-white py-3.5 rounded-xl font-bold flex justify-between px-6">
                    <span>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</span>
                    <span id="modal-total-price">0 ‡∏ö‡∏≤‡∏ó</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        // --- 1. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡πâ‡∏≤‡∏ô & Config ---
        const SHOP_LOC = [13.639417, 100.499580]; 
        const MAX_DIST_KM = 5.0; 
        const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbxjbXOkk-t1Q4EHKbwjte-qtBzu1Z066Lw8-r9AMov6AMDzBtrykZ06Docy7DJXvoGItA/exec"; 

        // ‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡∏¥‡∏î-‡∏õ‡∏¥‡∏î‡∏£‡πâ‡∏≤‡∏ô (24H Format)
        const OPEN_HOUR = 9;   // ‡πÄ‡∏õ‡∏¥‡∏î 09:00
        const CLOSE_HOUR = 24; // ‡∏õ‡∏¥‡∏î 20:00

        // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡πÄ‡∏û‡∏¥‡πà‡∏° stock: true/false)
        const menuDB = [
            // Recommend
            { id: 1, category: "recommend", name: "[‡∏Ç‡∏ß‡∏î‡πÉ‡∏´‡∏ç‡πà] ‡∏ô‡πâ‡∏≥‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏™‡∏î100% 1‡∏•‡∏¥‡∏ï‡∏£", desc: "‡∏ô‡πâ‡∏≥‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏™‡∏î‡πÅ‡∏ó‡πâ 100% ‡πÑ‡∏°‡πà‡∏ú‡∏™‡∏° ‡∏Ç‡∏ß‡∏î‡πÉ‡∏´‡∏ç‡πà", price: 100, originalPrice: 120, img: "https://lh3.googleusercontent.com/d/1_RUBx0m_aOzWzZrO_DgmzwXHJguxaf8F", stock: true },
            { id: 2, category: "recommend", name: "(‡∏Ç‡∏ß‡∏î‡πÉ‡∏´‡∏ç‡πà)‡∏ô‡πâ‡∏≥‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏™‡∏î 1000ml", desc: "‡∏ô‡πâ‡∏≥‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏™‡∏î‡πÅ‡∏ó‡πâ 100% ‡πÑ‡∏°‡πà‡∏ú‡∏™‡∏° ‡∏Ç‡∏ß‡∏î‡πÉ‡∏´‡∏ç‡πà", price: 100, originalPrice: 75, img: "https://lh3.googleusercontent.com/d/1_RUBx0m_aOzWzZrO_DgmzwXHJguxaf8F", badge: "‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ #1", stock: true, options: [{ type: "radio", name: "‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ß‡∏≤‡∏ô", choices: [{ label: "‡∏´‡∏ß‡∏≤‡∏ô‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥", price: 0 }, { label: "‡∏´‡∏ß‡∏≤‡∏ô‡∏ô‡πâ‡∏≠‡∏¢", price: 0 }, { label: "‡∏´‡∏ß‡∏≤‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥", price: 0 }] }] },
            { id: 3, category: "recommend", name: "‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏õ‡∏±‡πà‡∏ô‡∏ô‡∏°‡∏™‡∏î", desc: "‡∏™‡∏π‡∏ï‡∏£‡∏ô‡∏°‡∏™‡∏î ‡∏´‡∏≠‡∏°‡∏°‡∏±‡∏ô ‡∏ô‡∏±‡∏ß‡∏™‡∏∏‡∏î‡πÜ", price: 119, originalPrice: 158, img: "https://images.unsplash.com/photo-1595981267035-7b04ca84a82d?w=400", stock: true, options: [{ type: "checkbox", name: "‡∏ó‡πá‡∏≠‡∏õ‡∏õ‡∏¥‡πâ‡∏á (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ 2)", max: 2, choices: [{ label: "‡∏•‡∏≠‡∏î‡∏ä‡πà‡∏≠‡∏á‡∏ß‡∏±‡∏î‡πÄ‡∏à‡∏©", price: 15 }, { label: "‡∏ó‡∏±‡∏ö‡∏ó‡∏¥‡∏°‡∏Å‡∏£‡∏≠‡∏ö", price: 15 }, { label: "‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏≠‡πà‡∏≠‡∏ô", price: 10 }] }] },
            { id: 4, category: "recommend", name: "‡∏ô‡πâ‡∏≥‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏™‡∏î (1 ‡∏•‡∏¥‡∏ï‡∏£)", desc: "‡∏ô‡πâ‡∏≥‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏™‡∏î‡πÅ‡∏ó‡πâ 100% ‡πÅ‡∏ä‡πà‡πÄ‡∏¢‡πá‡∏ô‡πÄ‡∏à‡∏µ‡πä‡∏¢‡∏ö", price: 293, originalPrice: 390, img: "https://images.unsplash.com/photo-1621506289937-a8e4df240d0b?w=400", stock: true },
            // Promotion
            { id: 91, category: "promotion", name: "‡πÄ‡∏ã‡∏ï‡∏à‡∏∏‡πÉ‡∏à (4‡∏Ç‡∏ß‡∏î‡πÉ‡∏´‡∏ç‡πà) ‡∏ô‡πâ‡∏≥‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏™‡∏î100%", desc: "‡∏ô‡πâ‡∏≥‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏™‡∏î 4 ‡∏Ç‡∏ß‡∏î‡πÉ‡∏´‡∏ç‡πà ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏û‡∏¥‡πÄ‡∏®‡∏©", price: 360, originalPrice: 400, badge: "‡∏•‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤ üî•", stock: true, img: "https://lh3.googleusercontent.com/d/1tgzD1ACl7ijl05_2QPJfWfZSrCL7XiTP", stock: true},
            { id: 5, category: "promotion", name: "Set ‡∏Ñ‡∏π‡πà‡∏´‡∏π‡∏î‡∏π‡πÇ‡∏≠‡πâ (2 ‡πÅ‡∏Å‡πâ‡∏ß)", desc: "‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏õ‡∏±‡πà‡∏ô‡∏ô‡∏°‡∏™‡∏î 2 ‡πÅ‡∏Å‡πâ‡∏ß ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏û‡∏¥‡πÄ‡∏®‡∏©", price: 220, originalPrice: 238, badge: "‡∏•‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤ üî•", stock: true, img: "https://images.unsplash.com/photo-1628519592415-3174241e3d3f?w=400", options: [{ type: "radio", name: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ß‡∏≤‡∏ô (‡πÅ‡∏Å‡πâ‡∏ß 1)", choices: [{ label: "‡∏õ‡∏Å‡∏ï‡∏¥", price: 0 }, { label: "‡∏ô‡πâ‡∏≠‡∏¢", price: 0 }] }, { type: "radio", name: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ß‡∏≤‡∏ô (‡πÅ‡∏Å‡πâ‡∏ß 2)", choices: [{ label: "‡∏õ‡∏Å‡∏ï‡∏¥", price: 0 }, { label: "‡∏ô‡πâ‡∏≠‡∏¢", price: 0 }] }] },
            { id: 6, category: "promotion", name: "‡∏ß‡∏∏‡πâ‡∏ô‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏ñ‡πâ‡∏ß‡∏¢‡∏¢‡∏±‡∏Å‡∏©‡πå", desc: "‡∏ß‡∏∏‡πâ‡∏ô‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏ó‡∏≥‡πÄ‡∏≠‡∏á ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡πÅ‡∏ô‡πà‡∏ô ‡∏´‡∏ß‡∏≤‡∏ô‡∏ô‡πâ‡∏≠‡∏¢", price: 35, originalPrice: 50, badge: "Flash Sale", img: "https://images.unsplash.com/photo-1598211028080-1a65499c089c?w=400", stock: false } // ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏°‡∏î
        ];

        let cart = [];
        let map, marker, userLat, userLng, distanceKm = 0;
        let deliveryFee = 0;
        let activeTab = 'recommend';
        
        // --- 2. Initial Setup ---
        document.addEventListener("DOMContentLoaded", () => {
            renderMenu(activeTab);
            initMap();
            updateFooterState('menu');
            // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏ö‡∏ö Auto Slide
            startBannerAutoSlide();
            
            // üß† Remember Me: ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏à‡∏≤‡∏Å LocalStorage
            if(localStorage.getItem('cust_name')) document.getElementById('cust-name').value = localStorage.getItem('cust_name');
            if(localStorage.getItem('cust_phone')) document.getElementById('cust-phone').value = localStorage.getItem('cust_phone');
            if(localStorage.getItem('cust_address')) document.getElementById('cust-address').value = localStorage.getItem('cust_address');
        });

        // --- 3. Navigation ---
        function showPage(pageId) {
            document.querySelectorAll('.page-section').forEach(el => el.classList.remove('active-section'));
            document.getElementById('page-' + pageId).classList.add('active-section');
            document.getElementById('category-tabs').style.display = (pageId === 'menu') ? 'flex' : 'none';
            
            // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏õ‡∏∏‡πà‡∏°‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö (‡∏ã‡πà‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏°‡∏ô‡∏π)
            const backBtn = document.getElementById('back-btn'); 
            if(backBtn) {
                if(pageId === 'menu') {
                    backBtn.style.opacity = '0'; 
                    backBtn.style.pointerEvents = 'none'; 
                } else {
                    backBtn.style.opacity = '1'; 
                    backBtn.style.pointerEvents = 'auto'; 
                }
            }
            updateFooterState(pageId);
            if(pageId === 'address') setTimeout(() => map.invalidateSize(), 200);
            window.scrollTo(0,0);
        }

        function goBack() {
            const current = document.querySelector('.active-section').id;
            if(current === 'page-cart') showPage('menu');
            else if(current === 'page-address') {
                if(cart.length === 0) showPage('menu'); 
                else showPage('cart');
            } 
            else if(current === 'page-payment') showPage('address');
        }

        function switchTab(cat) {
            activeTab = cat;
            document.getElementById('tab-recommend').className = cat === 'recommend' ? 'flex-1 text-center py-3 text-sm font-bold cursor-pointer transition-all tab-active relative' : 'flex-1 text-center py-3 text-sm font-bold cursor-pointer transition-all tab-inactive relative text-gray-400';
            document.getElementById('tab-promotion').className = cat === 'promotion' ? 'flex-1 text-center py-3 text-sm font-bold cursor-pointer transition-all tab-active relative' : 'flex-1 text-center py-3 text-sm font-bold cursor-pointer transition-all tab-inactive relative text-gray-400';
            renderMenu(cat);
        }

        // ‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡πâ‡∏≤‡∏ô‡πÄ‡∏õ‡∏¥‡∏î-‡∏õ‡∏¥‡∏î
        function isShopOpen() {
            const now = new Date();
            const hour = now.getHours();
            return hour >= OPEN_HOUR && hour < CLOSE_HOUR;
        }

        function updateFooterState(pageId) {
            const footer = document.getElementById('sticky-footer');
            
            // ‚è∞ Auto Open/Close Logic
            if (!isShopOpen()) {
                footer.classList.remove('hidden');
                footer.innerHTML = `
                    <div class="w-full bg-gray-400 text-white rounded-xl p-3.5 text-center font-bold shadow-lg">
                        ‚õî ‡∏£‡πâ‡∏≤‡∏ô‡∏õ‡∏¥‡∏î (‡πÄ‡∏õ‡∏¥‡∏î ${String(OPEN_HOUR).padStart(2,'0')}:00 - ${String(CLOSE_HOUR).padStart(2,'0')}:00 ‡∏ô.)
                    </div>
                `;
                return; // ‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô ‡πÑ‡∏°‡πà‡πÇ‡∏ä‡∏ß‡πå‡∏õ‡∏∏‡πà‡∏°‡∏≠‡∏∑‡πà‡∏ô
            }

            // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡πâ‡∏≤‡∏ô ‡πÉ‡∏´‡πâ‡πÇ‡∏ä‡∏ß‡πå‡∏õ‡∏∏‡πà‡∏°‡∏õ‡∏Å‡∏ï‡∏¥ (‡∏ï‡πâ‡∏≠‡∏á Reset HTML ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏î‡∏¥‡∏°‡∏Å‡πà‡∏≠‡∏ô)
            // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏Ñ‡∏∑‡∏≠‡πÅ‡∏¢‡∏Å div ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ö div ‡∏õ‡∏∏‡πà‡∏° ‡πÅ‡∏ï‡πà‡∏ß‡∏¥‡∏ò‡∏µ‡∏ô‡∏µ‡πâ‡∏á‡πà‡∏≤‡∏¢‡∏™‡∏∏‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏∞‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏±‡∏ö
            if(footer.innerHTML.includes('‡∏£‡πâ‡∏≤‡∏ô‡∏õ‡∏¥‡∏î')) location.reload(); // ‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏¥‡∏î‡∏ô‡∏∂‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡∏õ‡∏∏‡πà‡∏°

            footer.classList.remove('hidden');
            ['btn-view-cart', 'btn-go-address', 'btn-confirm-address', 'btn-confirm-order'].forEach(id => {
                document.getElementById(id).classList.add('hidden');
            });

            if(pageId === 'menu') {
                if(cart.length > 0) document.getElementById('btn-view-cart').classList.remove('hidden');
                else footer.classList.add('hidden');
            } 
            else if(pageId === 'cart') document.getElementById('btn-go-address').classList.remove('hidden');
            else if(pageId === 'address') document.getElementById('btn-confirm-address').classList.remove('hidden');
            else if(pageId === 'payment') document.getElementById('btn-confirm-order').classList.remove('hidden');
        }

        // --- 4. Menu & Cart ---
        function renderMenu(cat) {
            const list = document.getElementById('menu-list');
            const items = menuDB.filter(i => i.category === cat);
            
            list.innerHTML = items.map(item => {
                // üö´ Sold Out Logic
                const isSoldOut = !item.stock;
                
                return `
                <div class="bg-white p-4 border-b border-gray-100 flex gap-4 relative hover:bg-gray-50 transition active:bg-gray-100 cursor-pointer ${isSoldOut ? 'opacity-60 grayscale pointer-events-none' : ''}" onclick="${!isSoldOut ? `openModal(${item.id})` : ''}">
                    <div class="relative shrink-0 w-28 h-28">
                        <img src="${item.img}" class="w-full h-full object-cover rounded-xl shadow-sm">
                        ${item.badge && !isSoldOut ? `<span class="absolute top-0 left-0 bg-red-500 text-white text-[10px] font-bold px-2 py-0.5 rounded-tl-xl rounded-br-lg shadow-sm">${item.badge}</span>` : ''}
                        ${isSoldOut ? '<span class="absolute inset-0 flex items-center justify-center bg-black/40 text-white font-bold text-lg rounded-xl z-10">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏°‡∏î</span>' : ''}
                    </div>
                    
                    <div class="flex-1 flex flex-col justify-between py-1">
                        <div>
                            <h3 class="font-bold text-gray-800 text-base leading-tight mb-1">${item.name}</h3>
                            <p class="text-xs text-gray-500 line-clamp-2 leading-relaxed">${item.desc || '‡∏≠‡∏£‡πà‡∏≠‡∏¢ ‡∏™‡∏î‡∏ä‡∏∑‡πà‡∏ô ‡∏ï‡πâ‡∏≠‡∏á‡∏•‡∏≠‡∏á!'}</p>
                        </div>
                        <div class="flex items-end justify-between mt-2">
                            <div class="flex flex-col">
                                ${item.originalPrice ? `<span class="text-gray-300 text-xs line-through">‡∏ø${item.originalPrice}</span>` : ''}
                                <span class="text-green-600 font-bold text-lg">‡∏ø${item.price}</span>
                            </div>
                            ${!isSoldOut ? 
                            `<button class="bg-green-100 text-green-700 w-9 h-9 rounded-full flex items-center justify-center hover:bg-green-600 hover:text-white transition shadow-sm border border-green-200">
                                <i class="fa-solid fa-plus text-sm"></i>
                            </button>` : ''}
                        </div>
                    </div>
                </div>
            `}).join('');
        }

        // Modal Logic
        let currentItem, currentBasePrice;
        function openModal(id) {
             const item = menuDB.find(i=>i.id===id);
             if(!item.options || item.options.length === 0) { addToCart(item, [], item.price); return; }
             
             currentItem = item; currentBasePrice = item.price;
             document.getElementById('modal-item-name').innerText = item.name;
             
             const container = document.getElementById('modal-options'); container.innerHTML = '';
             item.options.forEach((opt, idx) => {
                 let html = `<div class="bg-gray-50 border border-gray-100 p-4 rounded-xl"><p class="font-semibold mb-3 text-gray-700 text-sm flex items-center gap-2">${opt.name}</p><div class="space-y-3">`;
                 opt.choices.forEach((choice, cIdx) => {
                     if (opt.type === 'radio') {
                         const isChecked = cIdx === 0 ? 'checked' : ''; 
                         html += `<label class="flex items-center justify-between cursor-pointer group"><div class="flex items-center"><input type="radio" name="opt-${idx}" value="${choice.label}" data-price="${choice.price}" ${isChecked} class="option-input text-green-600 focus:ring-green-500 w-4 h-4" onchange="calculateModalTotal()"><span class="ml-3 text-sm text-gray-600">${choice.label}</span></div>${choice.price > 0 ? `<span class="text-xs text-gray-500">+${choice.price}</span>` : ''}</label>`;
                     } else {
                         html += `<label class="flex items-center justify-between cursor-pointer group"><div class="flex items-center"><input type="checkbox" name="opt-${idx}" value="${choice.label}" data-price="${choice.price}" class="option-input text-green-600 rounded focus:ring-green-500 w-4 h-4" onchange="checkLimit(this, ${opt.max}); calculateModalTotal()"><span class="ml-3 text-sm text-gray-600">${choice.label}</span></div>${choice.price > 0 ? `<span class="text-xs text-gray-500">+${choice.price}</span>` : ''}</label>`;
                     }
                 });
                 html += `</div></div>`; container.innerHTML += html;
             });
             calculateModalTotal(); document.getElementById('option-modal').classList.remove('hidden');
        }

        function calculateModalTotal() {
            let total = currentBasePrice;
            document.querySelectorAll('.option-input:checked').forEach(input => { total += parseInt(input.getAttribute('data-price') || 0); });
            document.getElementById('modal-total-price').innerText = `‡∏ø${total}`;
        }
        function checkLimit(checkbox, max) {
            if (!max) return;
            const name = checkbox.name;
            const checkedCount = document.querySelectorAll(`input[name="${name}"]:checked`).length;
            if (checkedCount > max) { checkbox.checked = false; Swal.fire({ toast: true, position: 'top', icon: 'info', title: `‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î ${max} ‡∏≠‡∏¢‡πà‡∏≤‡∏á`, showConfirmButton: false, timer: 1500 }); }
        }
        function closeModal() { document.getElementById('option-modal').classList.add('hidden'); }
        function confirmAddToCart() {
            const selectedOptions = []; let totalPrice = currentBasePrice;
            document.querySelectorAll('.option-input:checked').forEach(input => { selectedOptions.push(input.value); totalPrice += parseInt(input.getAttribute('data-price') || 0); });
            addToCart(currentItem, selectedOptions, totalPrice); closeModal();
        }

        function addToCart(item, opts, price) {
            cart.push({ ...item, selectedOptions: opts, finalPrice: price });
            updateCartUI();
            if(document.querySelector('.active-section').id === 'page-menu') updateFooterState('menu');
            Swal.fire({ toast: true, position: 'top', icon: 'success', title: '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß', showConfirmButton: false, timer: 1000 });
        }

        function updateCartUI() {
            document.getElementById('footer-count').innerText = cart.length;
            const total = cart.reduce((sum, item) => sum + item.finalPrice, 0);
            document.getElementById('footer-total').innerText = `‡∏ø${total}`;
            document.getElementById('total-price-cart').innerText = `‡∏ø${total}`;
            
            const list = document.getElementById('cart-items');
            if(cart.length === 0) { list.innerHTML = `<div class="text-center py-10"><i class="fa-solid fa-basket-shopping text-4xl text-gray-200 mb-2"></i><p class="text-gray-400">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</p></div>`; return; }
            
            list.innerHTML = cart.map((item, idx) => {
                let optionsHtml = '';
                if (item.selectedOptions && item.selectedOptions.length > 0) {
                    optionsHtml = item.selectedOptions.map(opt => `<div class="text-xs text-gray-500 pl-2 flex items-center gap-1"><span class="w-1 h-1 rounded-full bg-gray-300"></span> ${opt}</div>`).join('');
                }
                return `
                <div class="flex justify-between items-start border-b border-gray-100 pb-4 last:border-0 animation-fade-in">
                    <div class="flex-1 pr-2">
                        <div class="flex items-center gap-2 mb-1">
                            <span class="font-bold text-gray-700 text-sm bg-gray-100 px-1.5 rounded text-[10px] h-fit">${idx + 1}</span>
                            <span class="font-semibold text-gray-800">${item.name}</span>
                        </div>
                        <div class="space-y-0.5 mt-1 border-l-2 border-gray-100 ml-1 pl-1">${optionsHtml}</div>
                        <div class="mt-2"><span class="text-xs text-red-500 font-medium cursor-pointer hover:underline flex items-center gap-1 w-fit" onclick="cart.splice(${idx},1);updateCartUI()"><i class="fa-solid fa-trash-can"></i> ‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span></div>
                    </div>
                    <span class="font-bold text-gray-800 whitespace-nowrap">‡∏ø${item.finalPrice}</span>
                </div>`;
            }).join('');
        }

        // --- 5. Map ---
        function initMap() {
            map = L.map('map', { zoomControl: false }).setView(SHOP_LOC, 14);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
            var shopIcon = L.icon({ iconUrl: 'https://cdn-icons-png.flaticon.com/512/273/273177.png', iconSize: [50, 50], iconAnchor: [25, 50], popupAnchor: [0, -50] });
            var customerIcon = L.icon({ iconUrl: 'https://cdn-icons-png.flaticon.com/512/2776/2776067.png', iconSize: [40, 40], iconAnchor: [20, 40], popupAnchor: [0, -40], shadowUrl: null });
            L.marker(SHOP_LOC, { icon: shopIcon }).addTo(map).bindPopup("<b>‡∏£‡πâ‡∏≤‡∏ô‡∏´‡∏ô‡∏∏‡πà‡∏°‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô</b><br>‡∏™‡πà‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏£‡πà‡∏≠‡∏¢‡∏à‡∏≤‡∏Å‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ").openPopup();
            marker = L.marker(SHOP_LOC, { draggable: true, icon: customerIcon }).addTo(map);
            map.on('click', function(e) { marker.setLatLng(e.latlng); calculateDelivery(e.latlng.lat, e.latlng.lng); map.panTo(e.latlng); });
            marker.on('dragend', function(e) { const pos = marker.getLatLng(); calculateDelivery(pos.lat, pos.lng); map.panTo(pos); });
        }

        function calculateDelivery(lat, lng) {
            userLat = lat; userLng = lng;
            distanceKm = getDistanceFromLatLonInKm(SHOP_LOC[0], SHOP_LOC[1], lat, lng);
            document.getElementById('header-distance').innerText = `‡∏´‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏£‡πâ‡∏≤‡∏ô ${distanceKm.toFixed(1)} ‡∏Å‡∏°.`;
            document.getElementById('distance-display').innerText = `${distanceKm.toFixed(1)} ‡∏Å‡∏°.`;
            
            const btnConfirm = document.getElementById('btn-confirm-address');
            if (distanceKm > MAX_DIST_KM) {
                document.getElementById('out-of-range-msg').classList.remove('hidden');
                document.getElementById('distance-display').classList.replace('bg-green-50','bg-red-50');
                document.getElementById('distance-display').classList.replace('text-green-600','text-red-600');
                btnConfirm.disabled = true; deliveryFee = 0;
            } else {
                document.getElementById('out-of-range-msg').classList.add('hidden');
                document.getElementById('distance-display').classList.replace('bg-red-50','bg-green-50');
                document.getElementById('distance-display').classList.replace('text-red-600','text-green-600');
                btnConfirm.disabled = false;
                const foodTotal = cart.reduce((s, i) => s + i.finalPrice, 0);
                let isFree = (distanceKm <= 1.5 && foodTotal >= 100) || (foodTotal >= 200);
                deliveryFee = isFree ? 0 : 40;
            }
        }
        function getDistanceFromLatLonInKm(lat1,lon1,lat2,lon2) { var R = 6371; var dLat = deg2rad(lat2-lat1); var dLon = deg2rad(lon2-lon1); var a = Math.sin(dLat/2) * Math.sin(dLat/2) + Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) * Math.sin(dLon/2) * Math.sin(dLon/2); var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); return R * c; }
        function deg2rad(deg) { return deg * (Math.PI/180); }

        // --- 6. Validate & Confirm ---
        function validateAndGoToPayment() {
            const name = document.getElementById('cust-name').value;
            const phone = document.getElementById('cust-phone').value;
            const address = document.getElementById('cust-address').value;
            if(!name || !phone || !address) return Swal.fire({icon: 'warning', text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô'});
            if(!userLat) return Swal.fire({icon: 'warning', text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î‡∏à‡∏∏‡∏î‡∏™‡πà‡∏á‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà'});
            if(distanceKm > MAX_DIST_KM) return Swal.fire({icon: 'error', text: `‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏≠‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á (‡∏à‡∏≥‡∏Å‡∏±‡∏î ${MAX_DIST_KM} ‡∏Å‡∏°.)`});

            const foodTotal = cart.reduce((s, i) => s + i.finalPrice, 0);
            let isFree = (distanceKm <= 1.5 && foodTotal >= 100) || (foodTotal >= 200);
            deliveryFee = isFree ? 0 : 40;
            const grandTotal = foodTotal + deliveryFee;

            document.getElementById('summary-food-total').innerText = `${foodTotal} ‡∏ö‡∏≤‡∏ó`;
            const feeDisplay = document.getElementById('summary-delivery-fee');
            const feeDetail = document.getElementById('delivery-details');
            
            if(deliveryFee === 0) {
                feeDisplay.innerText = "‡∏ü‡∏£‡∏µ"; feeDisplay.className = "text-green-600 font-bold";
                feeDetail.innerText = (distanceKm <= 1.5 && foodTotal >= 100) ? "(‡πÇ‡∏õ‡∏£‡πÉ‡∏Å‡∏•‡πâ‡∏ö‡πâ‡∏≤‡∏ô 1.5km)" : "(‡∏Ñ‡∏£‡∏ö 200‡∏ö.)";
                feeDetail.className = "text-[10px] text-green-600";
            } else {
                feeDisplay.innerText = `${deliveryFee} ‡∏ö‡∏≤‡∏ó`; feeDisplay.className = "text-gray-800";
                if (distanceKm <= 1.5 && foodTotal < 100) {
                    feeDetail.innerText = `(‡∏™‡∏±‡πà‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏µ‡∏Å ${100 - foodTotal}‡∏ö. ‡∏™‡πà‡∏á‡∏ü‡∏£‡∏µ!)`; feeDetail.className = "text-xs text-red-500 font-bold animate-pulse";
                } else if (foodTotal < 200) {
                    feeDetail.innerText = `(‡∏™‡∏±‡πà‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏µ‡∏Å ${200 - foodTotal}‡∏ö. ‡∏™‡πà‡∏á‡∏ü‡∏£‡∏µ)`; feeDetail.className = "text-[10px] text-orange-500";
                } else { feeDetail.innerText = ""; }
            }

            document.getElementById('summary-grand-total').innerText = `${grandTotal} ‡∏ö‡∏≤‡∏ó`;
            const promptpayNo = "0812345678"; 
            document.getElementById('qr-image').src = `https://promptpay.io/${promptpayNo}/${grandTotal}`;
            document.getElementById('qr-amount-display').innerText = `${grandTotal} ‡∏ö‡∏≤‡∏ó`;
            document.getElementById('cod-amount-display').innerText = `${grandTotal}`;
            showPage('payment');
        }

        function togglePaymentDetail() {
            const method = document.querySelector('input[name="paymentMethod"]:checked').value;
            document.getElementById('payment-transfer-detail').classList.toggle('hidden', method !== 'transfer');
            document.getElementById('payment-cod-detail').classList.toggle('hidden', method !== 'cod');
        }

        async function confirmOrder() {
            const method = document.querySelector('input[name="paymentMethod"]:checked').value;
            const name = document.getElementById('cust-name').value;
            const phone = document.getElementById('cust-phone').value;
            const address = document.getElementById('cust-address').value;
            const landmark = document.getElementById('cust-landmark').value;
            
            // üß† Remember Me: ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏•‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á
            localStorage.setItem('cust_name', name);
            localStorage.setItem('cust_phone', phone);
            localStorage.setItem('cust_address', address);

            let slipBase64 = "";
            if(method === 'transfer') {
                const fileInput = document.getElementById('slip-file');
                if(fileInput.files.length === 0) return Swal.fire({icon: 'warning', text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô'});
                slipBase64 = await toBase64(fileInput.files[0]);
            }

            Swal.fire({ title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå...', text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà ‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤', allowOutsideClick: false, didOpen: () => Swal.showLoading() });

            const orderData = {
                name: name, phone: phone, address: address, landmark: landmark, location: `${userLat},${userLng}`,
                items: cart.map((i, index) => {
                    let detail = `${index + 1}. ${i.name}`; 
                    if (i.selectedOptions && i.selectedOptions.length > 0) {
                        detail += i.selectedOptions.map(opt => `\n   ‚îî üî∏ ${opt}`).join(''); 
                    }
                    return detail;
                }).join('\n\n'),
                total: document.getElementById('summary-grand-total').innerText,
                paymentMethod: method, slipImage: slipBase64
            };

            fetch(WEB_APP_URL, {
                method: 'POST', mode: 'no-cors', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(orderData)
            }).then(() => {
                Swal.fire({ icon: 'success', title: '‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', text: '‡∏ó‡∏≤‡∏á‡∏£‡πâ‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏£‡∏±‡∏ö', confirmButtonColor: '#16a34a' }).then(() => location.reload());
            }).catch(err => {
                console.error(err); Swal.fire({ icon: 'error', text: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà' });
            });
        }

        const toBase64 = file => new Promise((resolve, reject) => {
            const reader = new FileReader(); reader.readAsDataURL(file);
            reader.onload = () => resolve(reader.result); reader.onerror = error => reject(error);
        });
        function startBannerAutoSlide() {
    const slider = document.getElementById('banner-slider');
    if (!slider) return;
    
    let scrollAmount = 0;
    setInterval(() => {
        const cardWidth = slider.offsetWidth + 12; // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î + gap
        scrollAmount += cardWidth;

        // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏õ‡∏™‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏´‡πâ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
        if (scrollAmount >= slider.scrollWidth) {
            scrollAmount = 0;
            slider.scrollTo({ left: 0, behavior: 'auto' }); // ‡∏ß‡∏≤‡∏£‡πå‡∏õ‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏£‡πá‡∏ß‡πÜ
        } else {
            slider.scrollTo({ left: scrollAmount, behavior: 'smooth' }); // ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ô‡∏∏‡πà‡∏°‡πÜ
        }
    }, 9000); // ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏∏‡∏Å 4 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
}
    </script>
</body>
</html>
