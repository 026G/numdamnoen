<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏´‡∏ô‡∏∏‡πà‡∏°‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô ‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏õ‡∏±‡πà‡∏ô</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap');
        
        body { font-family: 'Kanit', sans-serif; background-color: #f3f4f6; }
        
        /* ‡∏ã‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô */
        .page-section { display: none; }
        .active-section { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        /* CSS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Map */
        #map { height: 250px; width: 100%; border-radius: 0.5rem; z-index: 0; }

        /* Animation Modal */
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        .animate-slide-up { animation: slideUp 0.3s ease-out; }

        /* ‡∏ã‡πà‡∏≠‡∏ô Scrollbar ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏î‡πâ */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="pb-24"> <div class="max-w-md mx-auto min-h-screen bg-white shadow-2xl relative overflow-hidden">

        <header class="bg-white sticky top-0 z-30 shadow-sm">
            <div class="p-4 flex items-center gap-3">
                <button onclick="if(!document.getElementById('page-menu').classList.contains('active-section')) showPage('menu')" class="text-xl text-gray-700">
                    <i class="fa-solid fa-arrow-left"></i>
                </button>
                <div class="flex-1">
                    <h1 class="font-bold text-lg text-gray-800">‡∏´‡∏ô‡∏∏‡πà‡∏°‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô ‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏õ‡∏±‡πà‡∏ô</h1>
                    <p class="text-xs text-green-600"><i class="fa-solid fa-motorcycle"></i> ‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô 0 ‡∏ö‡∏≤‡∏ó</p>
                </div>
                <div class="text-gray-400"><i class="fa-solid fa-share-nodes"></i></div>
            </div>
            
            <div class="flex border-b text-gray-500 text-sm font-bold">
                <div class="flex-1 text-center py-2 border-b-2 border-green-600 text-green-600 cursor-pointer">‡πÄ‡∏°‡∏ô‡∏π‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</div>
                <div class="flex-1 text-center py-2 cursor-pointer hover:text-green-600">‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô</div>
                <div class="flex-1 text-center py-2 cursor-pointer hover:text-green-600">‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</div>
            </div>
        </header>

        <section id="page-menu" class="page-section active-section">
            <div class="p-4 bg-gray-50">
                <h2 class="font-bold text-lg mb-2 text-gray-700">‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô <span class="text-red-500 text-sm font-normal">(‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ)</span></h2>
            </div>
            <div id="menu-list" class="divide-y divide-gray-100">
                </div>
        </section>

        <section id="page-cart" class="page-section bg-gray-50 min-h-screen">
            <div class="bg-white p-4 shadow-sm mb-2">
                <h2 class="text-lg font-bold">‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h2>
            </div>

            <div id="cart-items" class="bg-white p-4 mb-4 space-y-4">
                <p class="text-gray-500 text-center py-8">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</p>
            </div>
            
            <div class="bg-white p-4 mb-24">
                <div class="flex justify-between text-gray-600 mb-2">
                    <span>‡∏Ñ‡πà‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£</span>
                    <span id="subtotal-price">0 ‡∏ö‡∏≤‡∏ó</span>
                </div>
                <div class="flex justify-between font-bold text-xl">
                    <span>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</span>
                    <span id="total-price-cart" class="text-green-600">0 ‡∏ö‡∏≤‡∏ó</span>
                </div>
            </div>
        </section>

        <section id="page-checkout" class="page-section bg-white min-h-screen p-4">
            <h2 class="text-lg font-bold mb-4">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏±‡∏î‡∏™‡πà‡∏á & ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h2>
            
            <div class="space-y-4">
                <div class="bg-gray-50 p-3 rounded-lg border">
                    <label class="block text-xs text-gray-500 mb-1">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö</label>
                    <input type="text" id="cust-name" class="w-full bg-transparent outline-none font-bold" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠">
                </div>
                <div class="bg-gray-50 p-3 rounded-lg border">
                    <label class="block text-xs text-gray-500 mb-1">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
                    <input type="tel" id="cust-phone" class="w-full bg-transparent outline-none font-bold" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£">
                </div>
                <div class="bg-gray-50 p-3 rounded-lg border">
                    <label class="block text-xs text-gray-500 mb-1">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</label>
                    <textarea id="cust-address" class="w-full bg-transparent outline-none" rows="2" placeholder="‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà, ‡∏ã‡∏≠‡∏¢, ‡∏à‡∏∏‡∏î‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï"></textarea>
                </div>
                
                <div>
                    <p class="text-sm font-bold mb-2">üìå ‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î‡∏à‡∏∏‡∏î‡∏™‡πà‡∏á (‡∏à‡∏¥‡πâ‡∏°‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà):</p>
                    <div id="map"></div>
                    <input type="hidden" id="latlong">
                </div>

                <div class="border-t pt-4 text-center">
                    <p class="font-bold mb-2 text-gray-700">‡∏™‡πÅ‡∏Å‡∏ô‡∏à‡πà‡∏≤‡∏¢ QR Code</p>
                    <img id="qr-image" src="" class="mx-auto w-40 h-40 object-contain mb-2 border p-2 rounded">
                    <p class="text-green-600 font-bold text-2xl" id="final-price-display">0 ‡∏ö‡∏≤‡∏ó</p>
                    <p class="text-xs text-gray-400">‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏≠‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á</p>
                </div>
            </div>
        </section>

        <div id="sticky-footer" class="fixed bottom-0 w-full max-w-md bg-white border-t p-4 z-40 hidden">
            <button id="btn-view-cart" onclick="showPage('cart')" class="w-full bg-green-600 text-white rounded-lg p-3 flex justify-between items-center shadow-lg hover:bg-green-700 transition">
                <div class="flex items-center gap-2">
                    <div class="bg-white text-green-600 font-bold w-6 h-6 rounded flex items-center justify-center text-sm" id="footer-count">0</div>
                    <span class="font-bold">‡∏î‡∏π‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</span>
                </div>
                <span class="font-bold text-lg" id="footer-total">‡∏ø0</span>
            </button>

            <div id="btn-checkout-group" class="hidden flex gap-2 w-full">
                <button onclick="showPage('menu')" class="w-1/3 bg-gray-200 text-gray-700 rounded-lg font-bold py-3">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
                <button onclick="goToCheckout()" class="w-2/3 bg-green-600 text-white rounded-lg font-bold py-3 shadow-lg">‡∏™‡∏±‡πà‡∏á‡πÄ‡∏•‡∏¢</button>
            </div>

            <div id="btn-confirm-group" class="hidden flex gap-2 w-full">
                <button onclick="showPage('cart')" class="w-1/3 bg-gray-200 text-gray-700 rounded-lg font-bold py-3">‡∏Å‡∏•‡∏±‡∏ö</button>
                <button onclick="confirmOrder()" class="w-2/3 bg-green-600 text-white rounded-lg font-bold py-3 shadow-lg">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô</button>
            </div>
        </div>

    </div> <div id="option-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex justify-center items-end sm:items-center z-50">
        <div class="bg-white w-full max-w-md rounded-t-2xl sm:rounded-xl p-5 shadow-lg animate-slide-up max-h-[85vh] flex flex-col">
            
            <div class="flex justify-between items-start mb-2">
                <div>
                    <h3 id="modal-item-name" class="text-xl font-bold text-gray-800">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π</h3>
                    <p class="text-sm text-gray-500" id="modal-item-desc">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</p>
                </div>
                <button onclick="closeModal()" class="text-gray-400 text-2xl bg-gray-100 w-8 h-8 rounded-full flex items-center justify-center">&times;</button>
            </div>

            <div id="modal-options" class="flex-1 overflow-y-auto mb-4 pr-1 space-y-4">
                </div>

            <div class="border-t pt-4">
                <button onclick="confirmAddToCart()" class="w-full bg-green-600 text-white py-3 rounded-lg font-bold shadow hover:bg-green-700 flex justify-between px-6">
                    <span>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</span>
                    <span id="modal-total-price">0 ‡∏ö‡∏≤‡∏ó</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        // --- 1. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡πÄ‡∏û‡∏¥‡πà‡∏° originalPrice ‡πÅ‡∏•‡∏∞ desc) ---
        const menuDB = [
            { 
                id: 1, 
                name: "‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏õ‡∏±‡πà‡∏ô (‡πÑ‡∏°‡πà‡πÉ‡∏™‡πà‡∏ô‡∏°)", 
                desc: "‡∏ô‡πâ‡∏≥‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏™‡∏î‡∏õ‡∏±‡πà‡∏ô‡πÅ‡∏ó‡πâ 100% ‡∏´‡∏≠‡∏°‡∏´‡∏ß‡∏≤‡∏ô‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥ ‡πÑ‡∏°‡πà‡∏ú‡∏™‡∏°‡∏ô‡πâ‡∏≥‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°",
                price: 65,
                originalPrice: 75, // ‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏ï‡πá‡∏° (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ç‡∏µ‡∏î‡∏Ü‡πà‡∏≤)
                img: "https://images.unsplash.com/photo-1546171753-97d7676e4602?w=400",
                badge: "‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ #1",
                options: [
                    {
                        type: "radio",
                        name: "‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ß‡∏≤‡∏ô",
                        choices: [
                            { label: "‡∏´‡∏ß‡∏≤‡∏ô‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥ (‡πÑ‡∏°‡πà‡πÄ‡∏ï‡∏¥‡∏°‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•)", price: 0 },
                            { label: "‡∏´‡∏ß‡∏≤‡∏ô‡∏ô‡πâ‡∏≠‡∏¢", price: 0 },
                            { label: "‡∏´‡∏ß‡∏≤‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥", price: 0 }
                        ]
                    }
                ]
            },
            { 
                id: 2, 
                name: "‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏õ‡∏±‡πà‡∏ô‡∏ô‡∏°‡∏™‡∏î", 
                desc: "‡∏™‡∏π‡∏ï‡∏£‡∏ô‡∏°‡∏™‡∏î ‡∏´‡∏≠‡∏°‡∏°‡∏±‡∏ô ‡∏ô‡∏±‡∏ß‡∏™‡∏∏‡∏î‡πÜ ‡πÉ‡∏ä‡πâ‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏ô‡πâ‡∏≥‡∏´‡∏≠‡∏°‡∏Ñ‡∏±‡∏î‡∏û‡∏¥‡πÄ‡∏®‡∏©",
                price: 119, 
                originalPrice: 158,
                badge: "‡∏î‡∏µ‡∏•‡πÄ‡∏î‡∏∑‡∏≠‡∏î",
                img: "https://images.unsplash.com/photo-1595981267035-7b04ca84a82d?w=400",
                options: [
                    {
                        type: "checkbox",
                        name: "‡∏ó‡πá‡∏≠‡∏õ‡∏õ‡∏¥‡πâ‡∏á (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ 2)",
                        max: 2, 
                        choices: [
                            { label: "‡∏•‡∏≠‡∏î‡∏ä‡πà‡∏≠‡∏á‡∏ß‡∏±‡∏î‡πÄ‡∏à‡∏©", price: 15 },
                            { label: "‡∏ó‡∏±‡∏ö‡∏ó‡∏¥‡∏°‡∏Å‡∏£‡∏≠‡∏ö", price: 15 },
                            { label: "‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏≠‡πà‡∏≠‡∏ô", price: 10 }
                        ]
                    }
                ]
            },
            { 
                id: 3, 
                name: "‡∏ô‡πâ‡∏≥‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏™‡∏î‡∏Ç‡∏ß‡∏î‡πÉ‡∏´‡∏ç‡πà (1 ‡∏•‡∏¥‡∏ï‡∏£)", 
                desc: "‡∏ô‡πâ‡∏≥‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏™‡∏î‡πÅ‡∏ó‡πâ 100% ‡πÑ‡∏°‡πà‡∏ú‡∏™‡∏°‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏• ‡πÅ‡∏ä‡πà‡πÄ‡∏¢‡πá‡∏ô‡πÄ‡∏à‡∏µ‡πä‡∏¢‡∏ö",
                price: 293, 
                originalPrice: 390,
                badge: "‡∏Ñ‡∏∏‡πâ‡∏°‡∏°‡∏≤‡∏Å",
                img: "https://images.unsplash.com/photo-1621506289937-a8e4df240d0b?w=400"
            }
        ];

        let cart = []; 
        let map, marker;
        let currentItem = null;
        let currentBasePrice = 0;

        // --- 2. ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô ---
        document.addEventListener("DOMContentLoaded", () => {
            renderMenu();
            initMap();
            updateFooterState('menu'); // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤ Menu
        });

        // --- 3. ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏•‡∏∞ Footer ---
        function showPage(pageId) {
            document.querySelectorAll('.page-section').forEach(el => el.classList.remove('active-section'));
            document.getElementById('page-' + pageId).classList.add('active-section');
            
            // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Footer ‡∏ï‡∏≤‡∏°‡∏´‡∏ô‡πâ‡∏≤
            updateFooterState(pageId);

            if(pageId === 'checkout') {
                setTimeout(() => { map.invalidateSize(); }, 200);
            }
            window.scrollTo(0,0);
        }

        function updateFooterState(pageId) {
            const footer = document.getElementById('sticky-footer');
            const btnCart = document.getElementById('btn-view-cart');
            const btnCheckout = document.getElementById('btn-checkout-group');
            const btnConfirm = document.getElementById('btn-confirm-group');

            footer.classList.remove('hidden'); // ‡πÅ‡∏™‡∏î‡∏á Footer ‡∏ï‡∏•‡∏≠‡∏î (‡∏¢‡∏Å‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡πà‡∏≤‡∏á)

            // ‡∏ã‡πà‡∏≠‡∏ô‡∏ó‡∏∏‡∏Å‡∏õ‡∏∏‡πà‡∏°‡∏Å‡πà‡∏≠‡∏ô
            btnCart.classList.add('hidden');
            btnCheckout.classList.add('hidden');
            btnConfirm.classList.add('hidden');

            if (pageId === 'menu') {
                // ‡∏ñ‡πâ‡∏≤‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏ß‡πà‡∏≤‡∏á ‡πÉ‡∏´‡πâ‡∏ã‡πà‡∏≠‡∏ô Footer ‡πÑ‡∏õ‡πÄ‡∏•‡∏¢
                if(cart.length === 0) {
                    footer.classList.add('hidden');
                } else {
                    btnCart.classList.remove('hidden');
                }
            } else if (pageId === 'cart') {
                btnCheckout.classList.remove('hidden');
            } else if (pageId === 'checkout') {
                btnConfirm.classList.remove('hidden');
            }
        }

        // --- 4. Render Menu (‡∏õ‡∏£‡∏±‡∏ö‡∏î‡∏µ‡πÑ‡∏ã‡∏ô‡πå‡πÉ‡∏´‡∏°‡πà) ---
        function renderMenu() {
            const list = document.getElementById('menu-list');
            list.innerHTML = menuDB.map(item => `
                <div class="bg-white p-4 flex gap-4 relative">
                    <div class="relative">
                        <img src="${item.img}" class="w-28 h-28 object-cover rounded-lg shadow-sm">
                        ${item.badge ? `<span class="absolute top-0 left-0 bg-red-500 text-white text-[10px] font-bold px-2 py-0.5 rounded-tl-lg rounded-br-lg">${item.badge}</span>` : ''}
                    </div>

                    <div class="flex-1 flex flex-col justify-between">
                        <div>
                            <h3 class="font-bold text-gray-800 text-lg leading-tight mb-1">${item.name}</h3>
                            <p class="text-xs text-gray-400 line-clamp-2">${item.desc || ''}</p>
                        </div>
                        
                        <div class="flex items-end justify-between mt-2">
                            <div>
                                <span class="text-red-500 font-bold text-lg">‡∏ø${item.price}</span>
                                ${item.originalPrice ? `<span class="text-gray-300 text-sm line-through ml-1">‡∏ø${item.originalPrice}</span>` : ''}
                            </div>
                            <button onclick="addToCart(${item.id})" class="bg-green-600 text-white w-8 h-8 rounded-full flex items-center justify-center shadow-lg active:scale-90 transition">
                                <i class="fa-solid fa-plus"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // --- 5. Modal Logic ---
        function addToCart(id) {
            const item = menuDB.find(p => p.id === id);
            if (!item.options || item.options.length === 0) {
                pushToCart(item, [], item.price);
                return;
            }
            openModal(item);
        }

        function openModal(item) {
            currentItem = item;
            currentBasePrice = item.price;
            
            document.getElementById('modal-item-name').innerText = item.name;
            document.getElementById('modal-item-desc').innerText = item.desc || '';
            
            const container = document.getElementById('modal-options');
            container.innerHTML = ''; 

            item.options.forEach((opt, idx) => {
                let html = `<div class="bg-gray-50 p-3 rounded-lg">
                    <p class="font-bold mb-2 text-gray-700 text-sm">${opt.name}</p>
                    <div class="space-y-2">`;
                
                if (opt.type === 'radio') {
                    opt.choices.forEach((choice, cIdx) => {
                        const isChecked = cIdx === 0 ? 'checked' : ''; 
                        html += `
                            <label class="flex items-center justify-between cursor-pointer">
                                <div class="flex items-center">
                                    <input type="radio" name="opt-${idx}" value="${choice.label}" data-price="${choice.price}" ${isChecked} class="option-input text-green-600 focus:ring-green-500 w-4 h-4" onchange="calculateModalTotal()">
                                    <span class="ml-2 text-sm text-gray-700">${choice.label}</span>
                                </div>
                                ${choice.price > 0 ? `<span class="text-sm text-gray-500">+${choice.price}</span>` : ''}
                            </label>
                        `;
                    });
                } else if (opt.type === 'checkbox') {
                    opt.choices.forEach((choice) => {
                        html += `
                            <label class="flex items-center justify-between cursor-pointer">
                                <div class="flex items-center">
                                    <input type="checkbox" name="opt-${idx}" value="${choice.label}" data-price="${choice.price}" class="option-input text-green-600 rounded focus:ring-green-500 w-4 h-4" onchange="checkLimit(this, ${opt.max}); calculateModalTotal()">
                                    <span class="ml-2 text-sm text-gray-700">${choice.label}</span>
                                </div>
                                ${choice.price > 0 ? `<span class="text-sm text-gray-500">+${choice.price}</span>` : ''}
                            </label>
                        `;
                    });
                }
                html += `</div></div>`;
                container.innerHTML += html;
            });

            calculateModalTotal();
            document.getElementById('option-modal').classList.remove('hidden');
        }

        function calculateModalTotal() {
            let total = currentBasePrice;
            document.querySelectorAll('.option-input:checked').forEach(input => {
                total += parseInt(input.getAttribute('data-price') || 0);
            });
            document.getElementById('modal-total-price').innerText = `‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏™‡πà‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤ - ‡∏ø${total}`;
        }

        function checkLimit(checkbox, max) {
            if (!max) return;
            const name = checkbox.name;
            const checkedCount = document.querySelectorAll(`input[name="${name}"]:checked`).length;
            if (checkedCount > max) {
                checkbox.checked = false;
                // ‡πÉ‡∏ä‡πâ Toast ‡πÅ‡∏ö‡∏ö‡πÄ‡∏á‡∏µ‡∏¢‡∏ö‡πÜ ‡πÑ‡∏°‡πà‡∏Ç‡∏±‡∏î‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞
                const Toast = Swal.mixin({ toast: true, position: 'top', showConfirmButton: false, timer: 1500 });
                Toast.fire({ icon: 'warning', title: `‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î ${max} ‡∏≠‡∏¢‡πà‡∏≤‡∏á` });
            }
        }

        function closeModal() {
            document.getElementById('option-modal').classList.add('hidden');
        }

        function confirmAddToCart() {
            const selectedOptions = [];
            let totalPrice = currentBasePrice;
            
            // Check Required Radio
            let allRequiredSelected = true;
            currentItem.options.forEach((opt, idx) => {
                if (opt.type === 'radio') {
                    if (!document.querySelector(`input[name="opt-${idx}"]:checked`)) allRequiredSelected = false;
                }
            });

            if (!allRequiredSelected) return Swal.fire({ icon: 'warning', title: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö' });

            document.querySelectorAll('.option-input:checked').forEach(input => {
                selectedOptions.push(input.value);
                totalPrice += parseInt(input.getAttribute('data-price') || 0);
            });

            pushToCart(currentItem, selectedOptions, totalPrice);
            closeModal();
        }

        function pushToCart(item, options, finalPrice) {
            cart.push({ ...item, selectedOptions: options, finalPrice: finalPrice });
            updateCartUI();
            
            // Animation ‡πÄ‡∏•‡πá‡∏Å‡πÜ ‡∏ó‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏° View Cart
            const btn = document.getElementById('btn-view-cart');
            btn.classList.add('scale-105');
            setTimeout(() => btn.classList.remove('scale-105'), 200);
            
            if(document.getElementById('page-menu').classList.contains('active-section')) {
                updateFooterState('menu');
            }
        }

        // --- 6. Cart & UI Updates ---
        function updateCartUI() {
            // Update ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà Footer
            document.getElementById('footer-count').innerText = cart.length;
            const total = cart.reduce((sum, item) => sum + item.finalPrice, 0);
            document.getElementById('footer-total').innerText = `‡∏ø${total}`;
            document.getElementById('total-price-cart').innerText = `‡∏ø${total}`;
            document.getElementById('subtotal-price').innerText = `‡∏ø${total}`;

            // Render ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
            const cartList = document.getElementById('cart-items');
            if(cart.length === 0) {
                cartList.innerHTML = '<p class="text-gray-400 text-center py-8 text-sm">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏µ‡πà‡∏ä‡∏≠‡∏ö‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢!</p>';
                return;
            }
            
            cartList.innerHTML = cart.map((item, index) => `
                <div class="flex justify-between items-start border-b pb-4 last:border-0 last:pb-0">
                    <div class="flex gap-3">
                        <div class="bg-green-100 text-green-600 w-6 h-6 rounded flex items-center justify-center text-xs font-bold mt-1">${index + 1}</div>
                        <div>
                            <h4 class="font-bold text-gray-800">${item.name}</h4>
                            ${item.selectedOptions && item.selectedOptions.length > 0 
                              ? `<p class="text-xs text-gray-500 mt-1">${item.selectedOptions.join(', ')}</p>` 
                              : ''}
                            <button onclick="removeFromCart(${index})" class="text-red-500 text-xs mt-2 underline">‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
                        </div>
                    </div>
                    <span class="font-bold text-gray-700">‡∏ø${item.finalPrice}</span>
                </div>
            `).join('');
        }

        function removeFromCart(index) {
            cart.splice(index, 1);
            updateCartUI();
            if(cart.length === 0 && document.getElementById('page-menu').classList.contains('active-section')) {
                updateFooterState('menu'); // ‡∏ã‡πà‡∏≠‡∏ô footer ‡∏ñ‡πâ‡∏≤‡∏´‡∏°‡∏î
            }
        }

        function goToCheckout() {
            if(cart.length === 0) return Swal.fire('‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤');
            
            const total = cart.reduce((sum, item) => sum + item.finalPrice, 0);
            const phone = "0812345678"; // ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏û‡∏¢‡πå
            
            document.getElementById('qr-image').src = `https://promptpay.io/${phone}/${total}`;
            document.getElementById('final-price-display').innerText = `${total} ‡∏ö‡∏≤‡∏ó`;
            
            showPage('checkout');
        }

        // --- 7. Map & Order ---
        function initMap() {
            const defaultLoc = [13.639484, 100.500646];
            map = L.map('map').setView(defaultLoc, 16);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
            marker = L.marker(defaultLoc).addTo(map);
            document.getElementById('latlong').value = `${defaultLoc[0]},${defaultLoc[1]}`;

            map.on('click', function(e) {
                marker.setLatLng(e.latlng);
                document.getElementById('latlong').value = `${e.latlng.lat},${e.latlng.lng}`;
                map.panTo(e.latlng);
            });
        }

        function confirmOrder() {
            const name = document.getElementById('cust-name').value;
            const phone = document.getElementById('cust-phone').value;
            
            if(!name || !phone) return Swal.fire('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£');

            Swal.fire({
                title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...',
                text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà',
                allowOutsideClick: false,
                didOpen: () => Swal.showLoading()
            });

            // ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á (‡πÉ‡∏™‡πà Fetch ‡∏à‡∏£‡∏¥‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà)
            setTimeout(() => {
                Swal.fire({
                    icon: 'success',
                    title: '‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                    text: '‡∏ó‡∏≤‡∏á‡∏£‡πâ‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÅ‡∏•‡πâ‡∏ß',
                    confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á',
                    confirmButtonColor: '#16a34a'
                }).then(() => {
                    location.reload(); 
                });
            }, 1500);
        }
    </script>
</body>
</html>
