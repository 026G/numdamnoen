<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏´‡∏ô‡∏∏‡πà‡∏°‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô ‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏õ‡∏±‡πà‡∏ô</title>
    <link rel="icon" type="image/png" href="https://lh3.googleusercontent.com/d/1j9sqxnSEJcCKIVZMfc20RlRP0zCU3YU8"> 
    <link rel="apple-touch-icon" href="https://lh3.googleusercontent.com/d/1j9sqxnSEJcCKIVZMfc20RlRP0zCU3YU8">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600&display=swap');
        
        body { 
            font-family: 'Prompt', sans-serif; 
            background-color: #f8f9fa;
            color: #333;
            -webkit-font-smoothing: antialiased;
        }
        
        .page-section { display: none; }
        .active-section { display: block; animation: fadeIn 0.4s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        
        #map { height: 300px; width: 100%; border-radius: 12px; z-index: 0; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .tab-active { color: #16a34a; border-bottom: 2px solid #16a34a; background-color: rgba(22, 163, 74, 0.05); }
        .tab-inactive { color: #6b7280; border-bottom: 2px solid transparent; }
        .payment-radio:checked + div { border-color: #16a34a; background-color: #f0fdf4; }
        .payment-radio:checked + div .radio-indicator { border-color: #16a34a; background-color: #16a34a; box-shadow: inset 0 0 0 3px white; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="pb-32"> 

    <div class="max-w-md mx-auto min-h-screen bg-white shadow-xl relative overflow-hidden sm:border-x sm:border-gray-100">

        <header class="bg-white sticky top-0 z-30 shadow-lg backdrop-blur-md bg-opacity-98">
            <div class="px-4 py-4 flex items-start gap-4">
                
                <button onclick="goBack()" class="mt-1 w-9 h-9 rounded-full bg-gray-50 text-gray-500 flex items-center justify-center hover:bg-green-50 hover:text-green-600 transition shadow-sm border border-gray-200 shrink-0">
                    <i class="fa-solid fa-arrow-left text-sm"></i>
                </button>
                
                <div class="flex-1 min-w-0 flex gap-3"> 
                    
                    <div class="shrink-0 relative">
                        <img src="https://lh3.googleusercontent.com/d/1j9sqxnSEJcCKIVZMfc20RlRP0zCU3YU8" class="w-20 h-20 rounded-full border-2 border-green-100 shadow-md object-cover bg-white">
                        
                        <span id="shop-status-badge" class="absolute -bottom-1 left-1/2 -translate-x-1/2 px-2 py-0.5 text-[9px] font-bold text-white rounded-full shadow-sm whitespace-nowrap hidden">
                            </span>
                    </div>

                    <div class="flex-1 min-w-0 flex flex-col justify-center gap-1.5">
                        
                        <h1 class="font-bold text-lg text-gray-800 leading-tight">
                            ‡∏´‡∏ô‡∏∏‡πà‡∏°‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô <span class="text-green-600">‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏õ‡∏±‡πà‡∏ô üå¥</span>
                        </h1>

                        <div class="flex flex-wrap items-center gap-x-2 gap-y-1 text-xs text-gray-500">
                            <div class="flex items-center gap-1 bg-gray-50 px-1.5 py-0.5 rounded border border-gray-100">
                                <i class="fa-regular fa-clock text-green-500"></i>
                                <span id="shop-hours-text">09:00-20:00</span>
                            </div>
                            <a href="tel:0622467746" class="hover:text-green-700 font-medium flex items-center gap-1">
                                <i class="fa-solid fa-phone text-green-500"></i> 062-246-7746
                            </a>
                        </div>

                        <div class="flex items-center justify-between gap-2 mt-0.5">
                            <div class="flex-1 min-w-0 flex items-center gap-1 text-[10px] text-gray-600 bg-blue-50 px-2 py-1 rounded border border-blue-100">
                                <i class="fa-solid fa-location-dot text-red-500 shrink-0"></i>
                                <span id="header-distance" class="truncate font-medium">‡∏£‡∏∞‡∏ö‡∏∏‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏™‡πà‡∏á</span>
                            </div>

                            <button id="header-tracking-btn" onclick="handleTrackingClick()" class="shrink-0 text-[10px] bg-green-600 text-white px-2.5 py-1 rounded-full hover:bg-green-700 transition shadow-sm font-bold flex items-center gap-1 border border-green-700">
                                </button>
                        </div>
                    </div>

                </div>
            </div>
            
            <div id="category-tabs" class="flex px-4 border-b border-gray-100 gap-4 mt-2">
                <div onclick="switchTab('recommend')" id="tab-recommend" class="flex-1 text-center py-3 text-sm font-bold cursor-pointer transition-all border-b-2 border-green-600 text-green-700 relative">
                    ‡∏î‡∏π‡πÄ‡∏°‡∏ô‡∏π
                </div>
                <div onclick="switchTab('promotion')" id="tab-promotion" class="flex-1 text-center py-3 text-sm font-medium cursor-pointer transition-all border-b-2 border-transparent text-gray-400 hover:text-gray-600">
                    ‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô
                </div>
            </div>
        </header>

        <section id="page-menu" class="page-section active-section">
            <div class="mt-4 px-5">
                <div id="banner-slider" class="flex overflow-x-auto snap-x snap-mandatory gap-3 no-scrollbar rounded-2xl" style="scroll-behavior: smooth;">
                    <div class="snap-center shrink-0 w-full h-40 relative rounded-2xl overflow-hidden shadow-md">
                        <img src="https://lh3.googleusercontent.com/d/1LHnoa4svvYWmUIiNUSd5uzK5OWeH00sm" class="w-full h-full object-cover">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent"></div>
                    </div>
                    <div class="snap-center shrink-0 w-full h-40 relative rounded-2xl overflow-hidden shadow-md">
                        <img src="https://lh3.googleusercontent.com/d/1ETSCcbns33VmVDTd2bq46Re5WG9pwTZA" class="w-full h-full object-cover">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent"></div>
                    </div>
                </div>
            </div>
           
            <div id="menu-list" class="pb-4"></div>
        </section>

        <section id="page-cart" class="page-section bg-gray-50 min-h-screen">
            <div class="bg-white px-5 py-4 shadow-sm mb-2">
                <h2 class="text-xl font-semibold text-gray-800">‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2>
            </div>
            <div id="cart-items" class="bg-white p-5 mb-3 space-y-4"></div>
            <div class="bg-white p-5 space-y-3">
                <div class="flex justify-between font-semibold text-xl text-gray-800">
                    <span>‡∏Ñ‡πà‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</span>
                    <span id="total-price-cart">0 ‡∏ö‡∏≤‡∏ó</span>
                </div>
                <p class="text-xs text-gray-400">*‡∏Ñ‡πà‡∏≤‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏à‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÉ‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</p>
            </div>
        </section>

        <section id="page-address" class="page-section bg-white min-h-screen px-5 py-6">
            <h2 class="text-xl font-semibold mb-2 text-gray-800">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</h2>
            <p class="text-sm text-gray-500 mb-6">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏á</p>
            
            <div class="space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-medium text-gray-700 mb-1">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö</label>
                        <input type="text" id="cust-name" class="w-full bg-gray-50 border border-gray-200 rounded-lg px-4 py-3 focus:ring-1 focus:ring-green-500 outline-none" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô">
                    </div>
                    <div>
                        <label class="block text-xs font-medium text-gray-700 mb-1">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</label>
                        <input type="tel" id="cust-phone" class="w-full bg-gray-50 border border-gray-200 rounded-lg px-4 py-3 focus:ring-1 focus:ring-green-500 outline-none" placeholder="08x-xxx-xxxx">
                    </div>
                </div>
                <div>
                    <label class="block text-xs font-medium text-gray-700 mb-1">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà (‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà/‡∏ã‡∏≠‡∏¢)</label>
                    <textarea id="cust-address" class="w-full bg-gray-50 border border-gray-200 rounded-lg px-4 py-3 focus:ring-1 focus:ring-green-500 outline-none" rows="2" placeholder="‡πÄ‡∏ä‡πà‡∏ô 123/4 ‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô..."></textarea>
                </div>
                <div>
                    <label class="block text-xs font-medium text-gray-700 mb-1">‡∏à‡∏∏‡∏î‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï (Optional)</label>
                    <input type="text" id="cust-landmark" class="w-full bg-gray-50 border border-gray-200 rounded-lg px-4 py-3 focus:ring-1 focus:ring-green-500 outline-none" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏£‡∏±‡πâ‡∏ß‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß, ‡∏ï‡∏£‡∏á‡∏Ç‡πâ‡∏≤‡∏°‡πÄ‡∏ã‡πÄ‡∏ß‡πà‡∏ô">
                </div>
                <div class="pt-2">
                    <div class="flex justify-between items-center mb-2">
                        <label class="text-sm font-semibold text-gray-700">üìç ‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î‡∏à‡∏∏‡∏î‡∏™‡πà‡∏á</label>
                        <span id="distance-display" class="text-xs font-bold text-gray-400 bg-gray-100 px-2 py-1 rounded">‡πÅ‡∏ï‡∏∞‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</span>
                    </div>
                    <div id="map"></div>
                    <p class="text-xs text-red-500 mt-2 hidden" id="out-of-range-msg"><i class="fa-solid fa-circle-exclamation"></i> ‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢ ‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏≠‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á (‡πÄ‡∏Å‡∏¥‡∏ô 5 ‡∏Å‡∏°.)</p>
                </div>
            </div>
        </section>

        <section id="page-payment" class="page-section bg-gray-50 min-h-screen">
            <div class="bg-white p-5 shadow-sm mb-4">
                <h2 class="text-lg font-bold text-gray-800 mb-4">‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏ä‡∏≥‡∏£‡∏∞</h2>
                <div class="space-y-2 text-sm">
                    <div class="flex justify-between text-gray-600">
                        <span>‡∏Ñ‡πà‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£</span>
                        <span id="summary-food-total">0 ‡∏ö‡∏≤‡∏ó</span>
                    </div>
                    <div class="flex justify-between text-gray-600">
                        <span>‡∏Ñ‡πà‡∏≤‡∏à‡∏±‡∏î‡∏™‡πà‡∏á <span id="delivery-details" class="ml-2"></span></span>
                        <span id="summary-delivery-fee">0 ‡∏ö‡∏≤‡∏ó</span>
                    </div>
                    <div class="border-t border-dashed pt-2 mt-2 flex justify-between text-lg font-bold text-gray-800">
                        <span>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</span>
                        <span id="summary-grand-total" class="text-green-600">0 ‡∏ö‡∏≤‡∏ó</span>
                    </div>
                </div>
            </div>

            <div class="bg-white p-5 shadow-sm">
                <h2 class="text-lg font-bold text-gray-800 mb-4">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h2>
                
                <label class="block mb-3 cursor-pointer">
                    <input type="radio" name="paymentMethod" value="transfer" class="payment-radio hidden" checked onchange="togglePaymentDetail()">
                    <div class="border rounded-xl p-4 flex items-center justify-between transition-all hover:bg-gray-50">
                        <div class="flex items-center gap-3">
                            <div class="w-5 h-5 rounded-full border border-gray-300 radio-indicator flex items-center justify-center"></div>
                            <span class="font-medium text-gray-700">‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô / ‡∏™‡πÅ‡∏Å‡∏ô‡∏à‡πà‡∏≤‡∏¢</span>
                        </div>
                        <i class="fa-solid fa-qrcode text-gray-400 text-xl"></i>
                    </div>
                </label>

                <div id="payment-transfer-detail" class="ml-2 pl-6 border-l-2 border-gray-200 mb-6 space-y-4">
                    <div class="bg-green-50 p-4 rounded-lg text-center border border-green-100 relative">
                        <p class="text-sm font-bold text-gray-600 mb-2">‡∏™‡πÅ‡∏Å‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡πà‡∏≤‡∏¢</p>
                        <img id="qr-image" src="" class="w-40 h-40 mx-auto bg-white p-2 rounded shadow-sm">
                        
                        <button onclick="downloadQR()" class="mt-2 text-xs bg-white border border-green-200 text-green-700 px-3 py-1 rounded-full shadow-sm hover:bg-green-100 flex items-center gap-1 mx-auto">
                            <i class="fa-solid fa-download"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏π‡∏õ
                        </button>

                        <p class="text-xl font-bold text-green-700 mt-2" id="qr-amount-display">0 ‡∏ö‡∏≤‡∏ó</p>
                    </div>

                    <div class="bg-gray-100 p-3 rounded-lg text-sm text-gray-600 space-y-1">
                        <p><strong>‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£:</strong> ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏û‡∏¢‡πå QR (Prompt QR)</p>
                        <p><strong>‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ:</strong> ‡∏ß‡∏¥‡∏ß‡∏±‡∏í‡∏ô‡πå‡∏ä‡∏±‡∏¢ ‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏ß‡∏¥‡∏ä‡∏±‡∏¢</p>
                        <div class="flex items-center gap-2">
                            <strong>‡πÄ‡∏•‡∏Ç‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏û‡∏¢‡πå:</strong> 
                            <span id="bank-acc-no" class="font-mono text-gray-800">062-246-7746</span>
                            <button onclick="copyToClipboard('0622467746')" class="text-xs text-blue-500 bg-blue-50 px-2 py-0.5 rounded border border-blue-100 hover:bg-blue-100">
                                <i class="fa-regular fa-copy"></i> ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å
                            </button>
                        </div>
                    </div>
                    <div>
                        <label class="block text-xs font-medium text-gray-700 mb-1">‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô</label>
                        <input type="file" id="slip-file" accept="image/*" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2.5 file:px-4 file:rounded-l-lg file:border-0 file:text-sm file:font-semibold file:bg-green-600 file:text-white hover:file:bg-green-700 border border-gray-300 rounded-lg cursor-pointer bg-white shadow-sm">
                    </div>
                </div>

                <label id="cod-label" class="block cursor-pointer relative">
                    <input type="radio" name="paymentMethod" value="cod" id="cod-radio" class="payment-radio hidden" onchange="togglePaymentDetail()">
                    <div id="cod-box" class="border rounded-xl p-4 flex items-center justify-between transition-all hover:bg-gray-50">
                        <div class="flex items-center gap-3">
                            <div class="w-5 h-5 rounded-full border border-gray-300 radio-indicator flex items-center justify-center"></div>
                            <div>
                                <span class="font-medium text-gray-700 block">‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á (COD)</span>
                                <span id="cod-warning-text" class="text-[10px] text-red-500 hidden">
                                    <i class="fa-solid fa-lock"></i> ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡∏™‡∏±‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
                                </span>
                            </div>
                        </div>
                        <i class="fa-solid fa-money-bill-wave text-gray-400 text-xl"></i>
                    </div>
                </label>

                <div id="payment-cod-detail" class="hidden ml-2 pl-6 border-l-2 border-gray-200 mt-3">
                    <div class="bg-yellow-50 text-yellow-800 p-3 rounded-lg text-sm flex items-start gap-2">
                        <i class="fa-solid fa-circle-info mt-1"></i>
                        <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡πÉ‡∏´‡πâ‡∏û‡∏≠‡∏î‡∏µ‡∏Å‡∏±‡∏ö‡∏¢‡∏≠‡∏î <strong><span id="cod-amount-display"></span></strong> ‡∏ö‡∏≤‡∏ó</p>
                    </div>
                </div>
            </div>
        </section>
        
        <section id="page-tracking" class="page-section bg-gray-50 min-h-screen">
            <div class="bg-white px-5 py-4 shadow-sm mb-4">
                <h2 class="text-xl font-bold text-gray-800">‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ üöö</h2>
                <p class="text-gray-500 text-xs mt-1">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
            </div>
            
            <div class="px-5">
                <div id="tracking-search-box" class="bg-white p-5 rounded-xl shadow-sm border border-gray-100 mb-6 hidden">
                    <label class="block text-gray-700 font-bold mb-2">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
                    <div class="flex gap-2">
                        <input type="tel" id="track-phone" placeholder="‡πÄ‡∏ä‡πà‡∏ô 0812345678" class="flex-1 bg-gray-50 border border-gray-200 text-gray-800 text-lg rounded-xl focus:ring-green-500 focus:border-green-500 block w-full p-3 transition" maxlength="10">
                        <button onclick="searchOrder()" class="bg-green-600 text-white rounded-xl px-6 font-bold hover:bg-green-700 transition shadow-lg">
                            <i class="fa-solid fa-magnifying-glass"></i>
                        </button>
                    </div>
                </div>

                <div id="tracking-result" class="space-y-4 pb-24">
                     <div class="text-center text-gray-300 py-10">
                        <i class="fa-solid fa-box-open text-4xl mb-2"></i>
                        <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</p>
                    </div>
                </div>
            </div>
        </section>

        <div id="sticky-footer" class="fixed bottom-0 w-full max-w-md bg-white/95 backdrop-blur shadow-[0_-4px_10px_rgba(0,0,0,0.05)] border-t p-4 z-40 hidden">
            
            <button id="btn-view-cart" onclick="showPage('cart')" class="w-full bg-green-600 text-white rounded-xl p-3.5 flex justify-between items-center shadow-lg hover:bg-green-700 transition transform active:scale-[0.98]">
                <div class="flex items-center gap-3">
                    <div class="bg-white/20 font-bold w-8 h-8 rounded-lg flex items-center justify-center text-sm" id="footer-count">0</div>
                    <span class="font-semibold">‡∏î‡∏π‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</span>
                </div>
                <span class="font-bold text-lg" id="footer-total">‡∏ø0</span>
            </button>

            <div id="btn-go-address" class="hidden w-full flex gap-3">
                <button onclick="showPage('menu')" class="shrink-0 w-28 bg-gray-100 text-gray-600 rounded-xl font-bold text-sm hover:bg-gray-200 transition shadow-sm border border-gray-200 flex items-center justify-center gap-2">
                    <i class="fa-solid fa-cart-plus"></i> ‡∏™‡∏±‡πà‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°
                </button>
                
                <button onclick="showPage('address')" class="flex-1 bg-green-600 text-white rounded-xl p-3.5 font-bold shadow-lg hover:bg-green-700 transition flex items-center justify-center gap-2">
                    ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ <i class="fa-solid fa-arrow-right"></i>
                </button>
            </div>
            
            <button id="btn-confirm-address" onclick="validateAndGoToPayment()" class="hidden w-full bg-green-600 text-white rounded-xl p-3.5 font-bold shadow-lg hover:bg-green-700 transition disabled:bg-gray-400">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà & ‡πÑ‡∏õ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</button>
            <button id="btn-confirm-order" onclick="confirmOrder()" class="hidden w-full bg-green-600 text-white rounded-xl p-3.5 font-bold shadow-lg hover:bg-green-700 transition">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</button>
        </div>

    </div>

    <div id="option-modal" class="fixed inset-0 bg-black/60 backdrop-blur-sm hidden flex justify-center items-end sm:items-center z-50 transition-opacity">
        <div class="bg-white w-full max-w-md rounded-t-3xl sm:rounded-2xl p-6 shadow-2xl animate-slide-up max-h-[85vh] flex flex-col">
            <div class="flex justify-between items-start mb-4 pb-2 border-b">
                <h3 id="modal-item-name" class="text-xl font-semibold text-gray-800">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π</h3>
                <button onclick="closeModal()" class="text-gray-400 text-2xl">√ó</button>
            </div>
            <div id="modal-options" class="flex-1 overflow-y-auto mb-4 pr-1 space-y-5 custom-scrollbar"></div>
            <div class="pt-2">
                <button onclick="confirmAddToCart()" class="w-full bg-green-600 text-white py-3.5 rounded-xl font-bold flex justify-between px-6">
                    <span>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</span>
                    <span id="modal-total-price">0 ‡∏ö‡∏≤‡∏ó</span>
                </button>
            </div>
        </div>
    </div>

<script>
        // --- 1. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡πâ‡∏≤‡∏ô & Config ---
        const SHOP_LOC = [13.639417, 100.499580]; 
        const MAX_DIST_KM = 5.0; 
        const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbxdDDXZ3-pmT6nykdkjg7wrh16ZZkPFY5rmF_LsWcoFk5BoULi-lVJJEcsjBi7zKIJwDQ/exec"; 
        const OPEN_HOUR = 9;   
        const CLOSE_HOUR = 24; 

        // üî• ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
        const menuDB = [
            // === RECOMMEND (‡∏£‡∏ß‡∏°‡∏ó‡∏∏‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡πÇ‡∏ä‡∏ß‡πå‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å) ===
            { id: 1, category: "recommend", subCategory: "üî• ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏≠‡∏î‡∏Æ‡∏¥‡∏ï", name: "[‡∏Ç‡∏ß‡∏î‡πÉ‡∏´‡∏ç‡πà] ‡∏ô‡πâ‡∏≥‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏™‡∏î100% (1000 ml.)", desc: "‡∏ô‡πâ‡∏≥‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏™‡∏î‡πÅ‡∏ó‡πâ 100% ‡πÑ‡∏°‡πà‡∏ú‡∏™‡∏° ‡∏Ç‡∏ß‡∏î‡πÉ‡∏´‡∏ç‡πà", price: 100, originalPrice: 120, img: "https://lh3.googleusercontent.com/d/1Yz3UIKQHOZcvIrR3ItjCrU7hNcBiVInF",badge: "‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ #1", stock: true },
            { id: 2, category: "recommend", subCategory: "üî• ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏≠‡∏î‡∏Æ‡∏¥‡∏ï", name: "(‡∏Ç‡∏ß‡∏î‡πÉ‡∏´‡∏ç‡πà)‡∏ô‡πâ‡∏≥‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏™‡∏î 1000ml", desc: "‡∏ô‡πâ‡∏≥‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏™‡∏î‡πÅ‡∏ó‡πâ 100% ‡πÑ‡∏°‡πà‡∏ú‡∏™‡∏° ‡∏Ç‡∏ß‡∏î‡πÉ‡∏´‡∏ç‡πà", price: 100, originalPrice: 75, img: "https://lh3.googleusercontent.com/d/19ro_rUeZkoPNdHJhgccYUDkfhC7G2E8U", badge: "‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ", stock: true, options: [{ type: "radio", name: "‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ß‡∏≤‡∏ô", choices: [{ label: "‡∏´‡∏ß‡∏≤‡∏ô‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥", price: 0 }, { label: "‡∏´‡∏ß‡∏≤‡∏ô‡∏ô‡πâ‡∏≠‡∏¢", price: 0 }, { label: "‡∏´‡∏ß‡∏≤‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥", price: 0 }] }] },

            { id: 301, category: "recommend", subCategory: "ü•• ‡πÄ‡∏°‡∏ô‡∏π‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏õ‡∏±‡πà‡∏ô", name: "‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏õ‡∏±‡πà‡∏ô‡∏ô‡∏°‡∏™‡∏î 22‡∏≠‡∏≠‡∏ô‡∏ã‡πå", desc: "‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏õ‡∏±‡πà‡∏ô‡∏ô‡∏°‡∏™‡∏î ‡∏´‡∏≠‡∏°‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡πÅ‡∏ó‡πâ ‡πÑ‡∏°‡πà‡πÉ‡∏™‡πà‡∏ô‡∏°‡∏Ç‡πâ‡∏ô‡∏´‡∏ß‡∏≤‡∏ô", price: 45, originalPrice: 50, badge: "‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ", stock: true, img: "https://lh3.googleusercontent.com/d/1w3_NDj4YyYchsHfB5snVg2p0MQoBxYhp", options: [ type: "radio", name: "‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ß‡∏≤‡∏ô", choices: [ label: "‡∏´‡∏ß‡∏≤‡∏ô‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤ (30)", price: 0 , label: "‡∏´‡∏ß‡∏≤‡∏ô‡∏ô‡πâ‡∏≠‡∏¢ (50)", price: 0  , label: "‡∏´‡∏ß‡∏≤‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥ (100)", price: 0,  label: "‡∏´‡∏ß‡∏≤‡∏ô‡∏°‡∏≤‡∏Å (125)", price: 0 ] ,  type: "checkbox", name: "‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏¥‡πÄ‡∏®‡∏©", choices: [ label: "‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏õ‡∏±‡πà‡∏ô‡πÄ‡∏Ç‡πâ‡∏°‡∏Ç‡πâ‡∏ô (+50%)", price: 15 , label: "‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡πÄ‡∏Ñ‡∏µ‡πâ‡∏¢‡∏ß (‡πÄ‡∏Ñ‡∏µ‡πâ‡∏¢‡∏ß‡πÄ‡∏û‡∏•‡∏¥‡∏ô‡πÜ)", price: 15 ], max: 2 ] },
            { id: 302, category: "recommend", subCategory: "ü•• ‡πÄ‡∏°‡∏ô‡∏π‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏õ‡∏±‡πà‡∏ô", name: "‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏õ‡∏±‡πà‡∏ô‡∏ô‡∏°‡∏™‡∏î", desc: "‡∏™‡∏π‡∏ï‡∏£‡∏ô‡∏°‡∏™‡∏î ‡∏´‡∏≠‡∏°‡∏°‡∏±‡∏ô ‡∏ô‡∏±‡∏ß‡∏™‡∏∏‡∏î‡πÜ", price: 119, originalPrice: 158, img: "https://lh3.googleusercontent.com/d/1w3_NDj4YyYchsHfB5snVg2p0MQoBxYhp", stock: true, options: [{ type: "checkbox", name: "‡∏ó‡πá‡∏≠‡∏õ‡∏õ‡∏¥‡πâ‡∏á (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ 2)", max: 2, choices: [{ label: "‡∏•‡∏≠‡∏î‡∏ä‡πà‡∏≠‡∏á‡∏ß‡∏±‡∏î‡πÄ‡∏à‡∏©", price: 15 }, { label: "‡∏ó‡∏±‡∏ö‡∏ó‡∏¥‡∏°‡∏Å‡∏£‡∏≠‡∏ö", price: 15 }, { label: "‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏≠‡πà‡∏≠‡∏ô", price: 10 }] }] },
            { id: 303, category: "recommend", subCategory: "ü•• ‡πÄ‡∏°‡∏ô‡∏π‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏õ‡∏±‡πà‡∏ô", name: "‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏õ‡∏±‡πà‡∏ô (‡πÑ‡∏°‡πà‡πÉ‡∏™‡πà‡∏ô‡∏°)", desc: "‡∏´‡∏ß‡∏≤‡∏ô‡πÄ‡∏¢‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏ô‡πÉ‡∏à ‡πÅ‡∏ö‡∏ö‡πÑ‡∏°‡πà‡πÉ‡∏™‡πà‡∏ô‡∏°", price: 99, img: "https://images.unsplash.com/photo-1546173159-315724a31696?w=400", stock: true },

            { id: 401, category: "recommend", subCategory: "üå¥ ‡∏ô‡πâ‡∏≥‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏™‡∏î", name: "[‡∏Ç‡∏ß‡∏î‡πÉ‡∏´‡∏ç‡πà] ‡∏ô‡πâ‡∏≥‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏™‡∏î (1000 ml.)", desc: "‡∏ô‡πâ‡∏≥‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏™‡∏î‡πÅ‡∏ó‡πâ 100% ‡πÑ‡∏°‡πà‡∏ú‡∏™‡∏° ‡∏Ç‡∏ß‡∏î‡πÉ‡∏´‡∏ç‡πà", price: 100, originalPrice: 120, img: "https://lh3.googleusercontent.com/d/1Yz3UIKQHOZcvIrR3ItjCrU7hNcBiVInF", stock: true },
            { id: 402, category: "recommend", subCategory: "üå¥ ‡∏ô‡πâ‡∏≥‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏™‡∏î", name: "‡∏ô‡πâ‡∏≥‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏™‡∏î (‡∏Ç‡∏ß‡∏î‡πÄ‡∏•‡πá‡∏Å 250 ml.)", desc: "‡∏ô‡πâ‡∏≥‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏™‡∏î‡πÅ‡∏ó‡πâ 100% ‡πÑ‡∏°‡πà‡∏ú‡∏™‡∏° ‡∏Ç‡∏ß‡∏î‡πÄ‡∏•‡πá‡∏Å", price: 30,  img: "https://lh3.googleusercontent.com/d/10oBcQVs5OXiWjkDeWCUW_4YAMY-X2DWa", stock: true },

            { id: 501, category: "recommend", subCategory: " ‡∏ô‡πâ‡∏≥‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏™‡∏î(‡∏ú‡∏™‡∏°)", name: "[‡∏ã‡∏µ‡∏•‡∏ù‡∏≤] ‡∏ô‡πâ‡∏≥‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏™‡∏î‡πÄ‡∏¢‡πá‡∏ô 22‡∏≠‡∏≠‡∏ô‡∏ã‡πå", desc: "", price: 35, stock: true, img: "https://lh3.googleusercontent.com/d/1ip84vEVkMrrnXOAqEO8CatM0KZOK8SBv" },
            { id: 502, category: "recommend", subCategory: " ‡∏ô‡πâ‡∏≥‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏™‡∏î(‡∏ú‡∏™‡∏°)", name: "[‡∏ã‡∏µ‡∏•‡∏ù‡∏≤] ‡∏ô‡πâ‡∏≥‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß(‡∏ô‡∏°)‡∏™‡∏î‡πÄ‡∏¢‡πá‡∏ô 22‡∏≠‡∏≠‡∏ô‡∏ã‡πå", desc: "", price: 35, stock: true, img: "https://lh3.googleusercontent.com/d/1_dnTVj5hrUpD55JzS27i4L5jUzVlVoNp" },

            { id: 881, category: "recommend", subCategory: " ‡∏Ç‡∏ô‡∏°‡πÑ‡∏ó‡∏¢", name: "‡∏ó‡∏≠‡∏á‡∏°‡πâ‡∏ß‡∏ô‡∏™‡∏î(‡πÉ‡∏ö‡πÄ‡∏ï‡∏¢‡∏•‡πâ‡∏ß‡∏ô)‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏≠‡πà‡∏≠‡∏ô", desc: "", price: 35, stock: true, img: "https://lh3.googleusercontent.com/d/1a9RusD_4p0PXmoCim9hWIzk0FGPt1zIk" },
            { id: 882, category: "recommend", subCategory: " ‡∏Ç‡∏ô‡∏°‡πÑ‡∏ó‡∏¢", name: "‡∏ó‡∏≠‡∏á‡∏°‡πâ‡∏ß‡∏ô‡∏™‡∏î(‡∏£‡∏ß‡∏°‡∏£‡∏™)‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏≠‡πà‡∏≠‡∏ô", desc: "", price: 35, stock: true, img: "https://lh3.googleusercontent.com/d/1qW-fvCrMixNSu_6TDTIToPAGtEZYwtnm" },
            // === PROMOTION (‡πÅ‡∏¢‡∏Å‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏´‡∏≤‡∏Å) ===
            { id: 91, category: "promotion", name: "[Set ‡∏Ñ‡∏∏‡πâ‡∏°] 4‡∏Ç‡∏ß‡∏î‡πÄ‡∏•‡πá‡∏Å ‡∏ô‡πâ‡∏≥‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏™‡∏î100%", desc: "‡∏ô‡πâ‡∏≥‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏™‡∏î 4 ‡∏Ç‡∏ß‡∏î‡πÄ‡∏•‡πá‡∏Å 250ml.x4 ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏û‡∏¥‡πÄ‡∏®‡∏©", price: 100, originalPrice: 120, badge: "‡∏•‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤ üî•", stock: true, img: "https://lh3.googleusercontent.com/d/11Dv4nyAER160iSp-Luymgp-p4LI39h3Y", stock: true},
            { id: 92, category: "promotion", name: "[Set ‡∏à‡∏∏‡πÉ‡∏à] 4‡∏Ç‡∏ß‡∏î‡πÉ‡∏´‡∏ç‡πà ‡∏ô‡πâ‡∏≥‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏™‡∏î100%", desc: "‡∏ô‡πâ‡∏≥‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏™‡∏î 4 ‡∏Ç‡∏ß‡∏î‡πÉ‡∏´‡∏ç‡πà 1000ml.x4 ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏û‡∏¥‡πÄ‡∏®‡∏©", price: 360, originalPrice: 400, badge: "‡∏•‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤ üî•", stock: true, img: "https://lh3.googleusercontent.com/d/1_hTuj-qkP1_54Vvoej67MkiH6QRBPlfV", stock: true},
            { id: 5, category: "promotion", name: "Set ‡∏Ñ‡∏π‡πà‡∏´‡∏π‡∏î‡∏π‡πÇ‡∏≠‡πâ (2 ‡πÅ‡∏Å‡πâ‡∏ß)", desc: "‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏õ‡∏±‡πà‡∏ô‡∏ô‡∏°‡∏™‡∏î 2 ‡πÅ‡∏Å‡πâ‡∏ß ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏û‡∏¥‡πÄ‡∏®‡∏©", price: 220, originalPrice: 238, badge: "‡∏•‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤ üî•", stock: true, img: "https://images.unsplash.com/photo-1628519592415-3174241e3d3f?w=400", options: [{ type: "radio", name: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ß‡∏≤‡∏ô (‡πÅ‡∏Å‡πâ‡∏ß 1)", choices: [{ label: "‡∏õ‡∏Å‡∏ï‡∏¥", price: 0 }, { label: "‡∏ô‡πâ‡∏≠‡∏¢", price: 0 }] }, { type: "radio", name: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ß‡∏≤‡∏ô (‡πÅ‡∏Å‡πâ‡∏ß 2)", choices: [{ label: "‡∏õ‡∏Å‡∏ï‡∏¥", price: 0 }, { label: "‡∏ô‡πâ‡∏≠‡∏¢", price: 0 }] }] },
            { id: 6, category: "promotion", name: "‡∏ß‡∏∏‡πâ‡∏ô‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏ñ‡πâ‡∏ß‡∏¢‡∏¢‡∏±‡∏Å‡∏©‡πå", desc: "‡∏ß‡∏∏‡πâ‡∏ô‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏ó‡∏≥‡πÄ‡∏≠‡∏á ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡πÅ‡∏ô‡πà‡∏ô ‡∏´‡∏ß‡∏≤‡∏ô‡∏ô‡πâ‡∏≠‡∏¢", price: 35, originalPrice: 50, badge: "Flash Sale", img: "https://images.unsplash.com/photo-1598211028080-1a65499c089c?w=400", stock: false } 
        ];

        let cart = [];
        let map, marker, userLat, userLng, distanceKm = 0;
        let deliveryFee = 0;
        let activeTab = 'recommend';
        let currentQty = 1;
        let trackingInterval = null; 
        
        // --- 2. Initial Setup ---
        document.addEventListener("DOMContentLoaded", () => {
            switchTab('recommend');
            initMap();
            updateFooterState('menu');
            startBannerAutoSlide();
            
            // üß† Remember Me: ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏à‡∏≤‡∏Å LocalStorage
            if(localStorage.getItem('cust_name')) document.getElementById('cust-name').value = localStorage.getItem('cust_name');
            if(localStorage.getItem('cust_phone')) document.getElementById('cust-phone').value = localStorage.getItem('cust_phone');
            if(localStorage.getItem('cust_address')) document.getElementById('cust-address').value = localStorage.getItem('cust_address');

            updateTrackingButtonState();
            updateShopStatusUI();
        });

        // --- 3. Navigation ---
        function showPage(pageId) {
            // ‡∏´‡∏¢‡∏∏‡∏î Auto Refresh ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤ Tracking
            if (pageId !== 'tracking' && trackingInterval) {
                clearInterval(trackingInterval);
                trackingInterval = null;
            }

            document.querySelectorAll('.page-section').forEach(el => el.classList.remove('active-section'));
            document.getElementById('page-' + pageId).classList.add('active-section');
            document.getElementById('category-tabs').style.display = (pageId === 'menu') ? 'flex' : 'none';
            
            // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏õ‡∏∏‡πà‡∏°‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö (‡∏ã‡πà‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏°‡∏ô‡∏π)
            const backBtn = document.querySelector('header button i.fa-arrow-left')?.parentElement;
            if(backBtn) {
                if(pageId === 'menu') {
                    backBtn.style.opacity = '0'; 
                    backBtn.style.pointerEvents = 'none'; 
                } else {
                    backBtn.style.opacity = '1'; 
                    backBtn.style.pointerEvents = 'auto'; 
                }
            }
            updateFooterState(pageId);
            if(pageId === 'address') setTimeout(() => map.invalidateSize(), 200);
            
            // üî• ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Tracking ‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞
            if(pageId === 'tracking') {
                initTrackingPage(); 
            }
            
            window.scrollTo(0,0);
        }

        function goBack() {
            const current = document.querySelector('.active-section').id;
            if(current === 'page-cart') showPage('menu');
            else if(current === 'page-address') {
                if(cart.length === 0) showPage('menu'); 
                else showPage('cart');
            } 
            else if(current === 'page-payment') showPage('address');
            else if(current === 'page-tracking') showPage('menu');
        }

        function switchTab(cat) {
            activeTab = cat;
            const tabs = ['recommend', 'promotion'];
            
            // ‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏õ‡∏∏‡πà‡∏°
            tabs.forEach(tabName => {
                const element = document.getElementById(`tab-${tabName}`);
                if (cat === tabName) {
                    element.className = 'flex-1 text-center py-3 text-sm font-bold cursor-pointer transition-all border-b-2 border-green-600 text-green-700 relative';
                } else {
                    element.className = 'flex-1 text-center py-3 text-sm font-medium cursor-pointer transition-all border-b-2 border-transparent text-gray-400 hover:text-gray-600';
                }
            });

            // ‡∏ã‡πà‡∏≠‡∏ô‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÄ‡∏î‡∏¥‡∏° (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
            const heading = document.getElementById('menu-heading');
            if(heading && heading.parentElement) heading.parentElement.style.display = 'none';

            renderMenu(cat);
        }

        // ‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡πâ‡∏≤‡∏ô‡πÄ‡∏õ‡∏¥‡∏î-‡∏õ‡∏¥‡∏î
        function isShopOpen() {
            const now = new Date();
            const hour = now.getHours();
            return hour >= OPEN_HOUR && hour < CLOSE_HOUR;
        }

        function updateFooterState(pageId) {
            const footer = document.getElementById('sticky-footer');
            
            // ‚è∞ Auto Open/Close Logic
            if (!isShopOpen()) {
                footer.classList.remove('hidden');
                footer.innerHTML = `
                    <div class="w-full bg-gray-400 text-white rounded-xl p-3.5 text-center font-bold shadow-lg">
                        ‚õî ‡∏£‡πâ‡∏≤‡∏ô‡∏õ‡∏¥‡∏î (‡πÄ‡∏õ‡∏¥‡∏î ${String(OPEN_HOUR).padStart(2,'0')}:00 - ${String(CLOSE_HOUR).padStart(2,'0')}:00 ‡∏ô.)
                    </div>
                `;
                return; // ‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô ‡πÑ‡∏°‡πà‡πÇ‡∏ä‡∏ß‡πå‡∏õ‡∏∏‡πà‡∏°‡∏≠‡∏∑‡πà‡∏ô
            }

            // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡πâ‡∏≤‡∏ô ‡πÉ‡∏´‡πâ‡πÇ‡∏ä‡∏ß‡πå‡∏õ‡∏∏‡πà‡∏°‡∏õ‡∏Å‡∏ï‡∏¥ (‡∏ï‡πâ‡∏≠‡∏á Reset HTML ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏î‡∏¥‡∏°‡∏Å‡πà‡∏≠‡∏ô)
            if(footer.innerHTML.includes('‡∏£‡πâ‡∏≤‡∏ô‡∏õ‡∏¥‡∏î')) location.reload(); 

            footer.classList.remove('hidden');
            ['btn-view-cart', 'btn-go-address', 'btn-confirm-address', 'btn-confirm-order'].forEach(id => {
                document.getElementById(id).classList.add('hidden');
            });

            if(pageId === 'menu') {
                if(cart.length > 0) document.getElementById('btn-view-cart').classList.remove('hidden');
                else footer.classList.add('hidden');
            } 
            else if(pageId === 'cart') document.getElementById('btn-go-address').classList.remove('hidden');
            else if(pageId === 'address') document.getElementById('btn-confirm-address').classList.remove('hidden');
            else if(pageId === 'payment') document.getElementById('btn-confirm-order').classList.remove('hidden');
            else if(pageId === 'tracking') footer.classList.add('hidden');
        }

        // --- 4. Menu & Cart (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç renderMenu ‡πÅ‡∏•‡∏∞ createCard) ---
        function renderMenu(cat) {
            const list = document.getElementById('menu-list');
            const items = menuDB.filter(i => i.category === cat);
            
            // üî• ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á HTML ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÉ‡∏´‡πâ‡πÉ‡∏´‡∏ç‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà)
            const createCard = (item) => {
                const isSoldOut = !item.stock;
                const priceColorClass = item.originalPrice ? 'text-red-600' : 'text-green-600';
                
                return `
                <div class="bg-white p-4 border-b border-gray-100 flex gap-4 relative hover:bg-gray-50 transition active:bg-gray-100 cursor-pointer ${isSoldOut ? 'opacity-60 grayscale pointer-events-none' : ''}" onclick="${!isSoldOut ? `openModal(${item.id})` : ''}">
                    <div class="relative shrink-0 w-24 h-24">
                        <img src="${item.img}" class="w-full h-full object-cover rounded-xl shadow-sm">
                        ${item.badge && !isSoldOut ? `<span class="absolute top-0 left-0 bg-red-500 text-white text-[9px] font-bold px-1.5 py-0.5 rounded-tl-xl rounded-br-lg shadow-sm">${item.badge}</span>` : ''}
                        ${isSoldOut ? '<span class="absolute inset-0 flex items-center justify-center bg-black/40 text-white font-bold text-sm rounded-xl z-10">‡∏´‡∏°‡∏î</span>' : ''}
                    </div>
                    <div class="flex-1 flex flex-col justify-between py-0.5">
                        <div>
                            <h3 class="font-bold text-gray-800 text-base leading-tight mb-1">${item.name}</h3>
                            <p class="text-sm text-gray-500 line-clamp-2 leading-relaxed">${item.desc || ''}</p>
                        </div>
                        <div class="flex items-end justify-between mt-2">
                            <div class="flex flex-col">
                                ${item.originalPrice ? `<span class="text-gray-300 text-xs line-through">‡∏ø${item.originalPrice}</span>` : ''}
                                <span class="${priceColorClass} font-bold text-lg">‡∏ø${item.price}</span>
                            </div>
                            ${!isSoldOut ? `<button class="bg-green-50 text-green-600 w-8 h-8 rounded-full flex items-center justify-center hover:bg-green-600 hover:text-white transition shadow-sm border border-green-200"><i class="fa-solid fa-plus text-sm"></i></button>` : ''}
                        </div>
                    </div>
                </div>`;
            };

            // üî• ‡∏Å‡∏£‡∏ì‡∏µ 1: ‡∏´‡∏ô‡πâ‡∏≤ Promotion (‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏¢ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏¢‡∏Å‡∏´‡∏°‡∏ß‡∏î)
            if (cat === 'promotion') {
                if(items.length === 0) {
                    list.innerHTML = `<div class="text-center py-10 text-gray-400">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô</div>`;
                } else {
                    list.innerHTML = items.map(createCard).join('');
                }
                return;
            }

            // üî• ‡∏Å‡∏£‡∏ì‡∏µ 2: ‡∏´‡∏ô‡πâ‡∏≤ Recommend (‡πÅ‡∏¢‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏ï‡∏≤‡∏° subCategory)
            const subCats = [...new Set(items.map(i => i.subCategory || '‡∏≠‡∏∑‡πà‡∏ô‡πÜ'))];
            let finalHTML = '';
            
            subCats.forEach(subCatName => {
                const subItems = items.filter(i => (i.subCategory || '‡∏≠‡∏∑‡πà‡∏ô‡πÜ') === subCatName);
                if (subItems.length > 0) {
                    finalHTML += `
                        <div class="sticky top-0 bg-gray-50/95 backdrop-blur px-5 py-3 border-b border-gray-100 z-10">
                            <h3 class="font-bold text-gray-800 text-lg">${subCatName}</h3>
                        </div>
                    `;
                    finalHTML += subItems.map(createCard).join('');
                }
            });

            list.innerHTML = finalHTML;
        }

        // --- Modal Logic ---
        let currentItem, currentBasePrice;

        function openModal(id) {
             const item = menuDB.find(i=>i.id===id);
             
             // üî• Reset ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏õ‡πá‡∏ô 1 ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î
             currentQty = 1;
             currentItem = item; 
             currentBasePrice = item.price;
             document.getElementById('modal-item-name').innerText = item.name;
             
             const container = document.getElementById('modal-options'); 
             container.innerHTML = '';

             // üî• ‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
             if(item.options && item.options.length > 0) {
                 item.options.forEach((opt, idx) => {
                     let html = `<div class="bg-gray-50 border border-gray-100 p-4 rounded-xl mb-3"><p class="font-semibold mb-3 text-gray-700 text-sm flex items-center gap-2">${opt.name}</p><div class="space-y-3">`;
                     opt.choices.forEach((choice, cIdx) => {
                         if (opt.type === 'radio') {
                             const isChecked = cIdx === 0 ? 'checked' : ''; 
                             html += `<label class="flex items-center justify-between cursor-pointer group"><div class="flex items-center"><input type="radio" name="opt-${idx}" value="${choice.label}" data-price="${choice.price}" ${isChecked} class="option-input text-green-600 focus:ring-green-500 w-4 h-4" onchange="calculateModalTotal()"><span class="ml-3 text-sm text-gray-600">${choice.label}</span></div>${choice.price > 0 ? `<span class="text-xs text-gray-500">+${choice.price}</span>` : ''}</label>`;
                         } else {
                             html += `<label class="flex items-center justify-between cursor-pointer group"><div class="flex items-center"><input type="checkbox" name="opt-${idx}" value="${choice.label}" data-price="${choice.price}" class="option-input text-green-600 rounded focus:ring-green-500 w-4 h-4" onchange="checkLimit(this, ${opt.max}); calculateModalTotal()"><span class="ml-3 text-sm text-gray-600">${choice.label}</span></div>${choice.price > 0 ? `<span class="text-xs text-gray-500">+${choice.price}</span>` : ''}</label>`;
                         }
                     });
                     html += `</div></div>`; 
                     container.innerHTML += html;
                 });
             } else {
                 container.innerHTML = `<div class="text-center text-gray-400 text-sm py-2"></div>`;
             }

             // üî• ‡πÅ‡∏ó‡∏£‡∏Å‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô (+/-) ‡∏•‡∏á‡πÑ‡∏õ‡πÉ‡∏ô Modal
             const qtyHtml = `
                <div class="flex items-center justify-between mt-4 pt-4 border-t border-gray-100">
                    <span class="font-bold text-gray-700">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</span>
                    <div class="flex items-center gap-3 bg-gray-100 rounded-full p-1">
                        <button onclick="adjustQty(-1)" class="w-8 h-8 rounded-full bg-white shadow text-green-600 font-bold hover:bg-green-50 flex items-center justify-center transition"><i class="fa-solid fa-minus"></i></button>
                        <span id="qty-display" class="font-bold text-gray-800 w-8 text-center text-lg">1</span>
                        <button onclick="adjustQty(1)" class="w-8 h-8 rounded-full bg-white shadow text-green-600 font-bold hover:bg-green-50 flex items-center justify-center transition"><i class="fa-solid fa-plus"></i></button>
                    </div>
                </div>
             `;
             container.insertAdjacentHTML('beforeend', qtyHtml);

             calculateModalTotal(); 
             document.getElementById('option-modal').classList.remove('hidden');
        }

        // üî• ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏õ‡∏£‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô
        function adjustQty(change) {
            const newQty = currentQty + change;
            if(newQty < 1) return;
            currentQty = newQty;
            document.getElementById('qty-display').innerText = currentQty;
            calculateModalTotal();
        }

        function calculateModalTotal() {
            let pricePerItem = currentBasePrice;
            document.querySelectorAll('.option-input:checked').forEach(input => { 
                pricePerItem += parseInt(input.getAttribute('data-price') || 0); 
            });
            
            // üî• ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏° = (‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏ä‡∏¥‡πâ‡∏ô + ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å) * ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô
            const totalPrice = pricePerItem * currentQty;
            document.getElementById('modal-total-price').innerText = `‡∏ø${totalPrice}`;
        }

        function checkLimit(checkbox, max) {
            if (!max) return;
            const name = checkbox.name;
            const checkedCount = document.querySelectorAll(`input[name="${name}"]:checked`).length;
            if (checkedCount > max) { checkbox.checked = false; Swal.fire({ toast: true, position: 'top', icon: 'info', title: `‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î ${max} ‡∏≠‡∏¢‡πà‡∏≤‡∏á`, showConfirmButton: false, timer: 1500 }); }
        }

        function closeModal() { document.getElementById('option-modal').classList.add('hidden'); }

        function confirmAddToCart() {
            const selectedOptions = []; 
            let pricePerItem = currentBasePrice;
            
            document.querySelectorAll('.option-input:checked').forEach(input => { 
                selectedOptions.push(input.value); 
                pricePerItem += parseInt(input.getAttribute('data-price') || 0); 
            });

            // üî• ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏™‡πà‡∏á‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤ (‡∏Ñ‡∏π‡∏ì‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÅ‡∏•‡πâ‡∏ß)
            const finalTotalPrice = pricePerItem * currentQty;

            addToCart(currentItem, selectedOptions, finalTotalPrice, currentQty); 
            closeModal();
        }

        function addToCart(item, opts, price, qty) {
            // üî• ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô (qty) ‡∏•‡∏á‡πÑ‡∏õ‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏î‡πâ‡∏ß‡∏¢
            cart.push({ ...item, selectedOptions: opts, finalPrice: price, qty: qty });
            updateCartUI();
            if(document.querySelector('.active-section').id === 'page-menu') updateFooterState('menu');
            Swal.fire({ toast: true, position: 'top', icon: 'success', title: '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß', showConfirmButton: false, timer: 1000 });
        }

        function updateCartUI() {
            document.getElementById('footer-count').innerText = cart.length;
            const total = cart.reduce((sum, item) => sum + item.finalPrice, 0);
            document.getElementById('footer-total').innerText = `‡∏ø${total}`;
            document.getElementById('total-price-cart').innerText = `‡∏ø${total}`;
            
            const list = document.getElementById('cart-items');
            if(cart.length === 0) { list.innerHTML = `<div class="text-center py-10"><i class="fa-solid fa-basket-shopping text-4xl text-gray-200 mb-2"></i><p class="text-gray-400">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</p></div>`; return; }
            
            list.innerHTML = cart.map((item, idx) => {
                let optionsHtml = '';
                if (item.selectedOptions && item.selectedOptions.length > 0) {
                    optionsHtml = item.selectedOptions.map(opt => `<div class="text-xs text-gray-500 pl-2 flex items-center gap-1"><span class="w-1 h-1 rounded-full bg-gray-300"></span> ${opt}</div>`).join('');
                }
                return `
                <div class="flex justify-between items-start border-b border-gray-100 pb-4 last:border-0 animation-fade-in">
                    <div class="flex-1 pr-2">
                        <div class="flex items-center gap-2 mb-1">
                            <span class="font-bold text-gray-700 text-sm bg-gray-100 px-1.5 rounded text-[10px] h-fit">${idx + 1}</span>
                            <span class="font-semibold text-gray-800">${item.qty}x ${item.name}</span>
                        </div>
                        <div class="space-y-0.5 mt-1 border-l-2 border-gray-100 ml-1 pl-1">${optionsHtml}</div>
                        <div class="mt-2"><span class="text-xs text-red-500 font-medium cursor-pointer hover:underline flex items-center gap-1 w-fit" onclick="cart.splice(${idx},1);updateCartUI()"><i class="fa-solid fa-trash-can"></i> ‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span></div>
                    </div>
                    <span class="font-bold text-gray-800 whitespace-nowrap">‡∏ø${item.finalPrice}</span>
                </div>`;
            }).join('');
        }

        // --- 5. Map (üî• ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡πÉ‡∏´‡πâ‡∏à‡∏≥‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î) ---
        function initMap() {
            map = L.map('map', { zoomControl: false }); // ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà setView ‡∏£‡∏≠‡πÄ‡∏ä‡πá‡∏Ñ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏Å‡πà‡∏≠‡∏ô
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
            
            var shopIcon = L.icon({ iconUrl: 'https://cdn-icons-png.flaticon.com/512/273/273177.png', iconSize: [50, 50], iconAnchor: [25, 50], popupAnchor: [0, -50] });
            var customerIcon = L.icon({ iconUrl: 'https://cdn-icons-png.flaticon.com/512/2776/2776067.png', iconSize: [40, 40], iconAnchor: [20, 40], popupAnchor: [0, -40], shadowUrl: null });
            
            // ‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î‡∏£‡πâ‡∏≤‡∏ô (‡∏Ñ‡∏á‡∏ó‡∏µ‡πà)
            L.marker(SHOP_LOC, { icon: shopIcon }).addTo(map).bindPopup("<b>‡∏£‡πâ‡∏≤‡∏ô‡∏´‡∏ô‡∏∏‡πà‡∏°‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô</b><br>‡∏™‡πà‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏£‡πà‡∏≠‡∏¢‡∏à‡∏≤‡∏Å‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ").openPopup();

            // üî• Check ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á
            const savedLat = localStorage.getItem('cust_lat');
            const savedLng = localStorage.getItem('cust_lng');
            
            let startLoc = SHOP_LOC;
            let startZoom = 14;

            // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÄ‡∏Å‡πà‡∏≤ -> ‡πÉ‡∏ä‡πâ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÄ‡∏Å‡πà‡∏≤ + ‡∏ã‡∏π‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏Å‡∏•‡πâ‡πÜ
            if (savedLat && savedLng) {
                startLoc = [parseFloat(savedLat), parseFloat(savedLng)];
                startZoom = 16; 
            }

            // Set ‡∏°‡∏∏‡∏°‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
            map.setView(startLoc, startZoom);

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏°‡∏∏‡∏î‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (Draggable)
            marker = L.marker(startLoc, { draggable: true, icon: customerIcon }).addTo(map);
            
            // Events ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà (‡∏Å‡∏î‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á / ‡∏•‡∏≤‡∏Å‡∏´‡∏°‡∏∏‡∏î)
            map.on('click', function(e) { 
                marker.setLatLng(e.latlng); 
                calculateDelivery(e.latlng.lat, e.latlng.lng); 
            });
            
            marker.on('dragend', function(e) { 
                const pos = marker.getLatLng(); 
                calculateDelivery(pos.lat, pos.lng); 
                map.panTo(pos); 
            });

            // üî• ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÄ‡∏Å‡πà‡∏≤ -> ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏¢‡∏ó‡∏±‡∏ô‡∏ó‡∏µ!
            if (savedLat && savedLng) {
                calculateDelivery(startLoc[0], startLoc[1]);
            }
        }

        function calculateDelivery(lat, lng) {
            userLat = lat; userLng = lng;
            distanceKm = getDistanceFromLatLonInKm(SHOP_LOC[0], SHOP_LOC[1], lat, lng);
            document.getElementById('header-distance').innerText = `‡∏´‡πà‡∏≤‡∏á ${distanceKm.toFixed(1)} ‡∏Å‡∏°. ‡∏à‡∏≤‡∏Å‡∏£‡πâ‡∏≤‡∏ô`;
            document.getElementById('distance-display').innerText = `${distanceKm.toFixed(1)} ‡∏Å‡∏°.`;
            
            const btnConfirm = document.getElementById('btn-confirm-address');
            if (distanceKm > MAX_DIST_KM) {
                document.getElementById('out-of-range-msg').classList.remove('hidden');
                document.getElementById('distance-display').classList.replace('bg-green-50','bg-red-50');
                document.getElementById('distance-display').classList.replace('text-green-600','text-red-600');
                btnConfirm.disabled = true; deliveryFee = 0;
            } else {
                document.getElementById('out-of-range-msg').classList.add('hidden');
                document.getElementById('distance-display').classList.replace('bg-red-50','bg-green-50');
                document.getElementById('distance-display').classList.replace('text-red-600','text-green-600');
                btnConfirm.disabled = false;
                const foodTotal = cart.reduce((s, i) => s + i.finalPrice, 0);
                let isFree = (distanceKm <= 1.5 && foodTotal >= 100) || (foodTotal >= 200);
                deliveryFee = isFree ? 0 : 40;
            }
        }
        function getDistanceFromLatLonInKm(lat1,lon1,lat2,lon2) { var R = 6371; var dLat = deg2rad(lat2-lat1); var dLon = deg2rad(lon2-lon1); var a = Math.sin(dLat/2) * Math.sin(dLat/2) + Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) * Math.sin(dLon/2) * Math.sin(dLon/2); var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); return R * c; }
        function deg2rad(deg) { return deg * (Math.PI/180); }

        // --- 6. Validate & Confirm ---
        function validateAndGoToPayment() {
            const name = document.getElementById('cust-name').value;
            const phone = document.getElementById('cust-phone').value;
            const address = document.getElementById('cust-address').value;
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô
            if(!name || !phone || !address) return Swal.fire({icon: 'warning', text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô'});
            if(!userLat) return Swal.fire({icon: 'warning', text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î‡∏à‡∏∏‡∏î‡∏™‡πà‡∏á‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà'});
            if(distanceKm > MAX_DIST_KM) return Swal.fire({icon: 'error', text: `‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏≠‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á (‡∏à‡∏≥‡∏Å‡∏±‡∏î ${MAX_DIST_KM} ‡∏Å‡∏°.)`});

            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô
            const foodTotal = cart.reduce((s, i) => s + i.finalPrice, 0);
            let isFree = (distanceKm <= 1.5 && foodTotal >= 100) || (foodTotal >= 200);
            deliveryFee = isFree ? 0 : 40;
            const grandTotal = foodTotal + deliveryFee;

            // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î
            document.getElementById('summary-food-total').innerText = `${foodTotal} ‡∏ö‡∏≤‡∏ó`;
            const feeDisplay = document.getElementById('summary-delivery-fee');
            const feeDetail = document.getElementById('delivery-details');
            
            if(deliveryFee === 0) {
                feeDisplay.innerText = "‡∏ü‡∏£‡∏µ"; feeDisplay.className = "text-green-600 font-bold";
                feeDetail.innerText = (distanceKm <= 1.5 && foodTotal >= 100) ? "(‡πÇ‡∏õ‡∏£‡πÉ‡∏Å‡∏•‡πâ‡∏ö‡πâ‡∏≤‡∏ô 1.5km)" : "(‡∏Ñ‡∏£‡∏ö 200‡∏ö.)";
                feeDetail.className = "text-[10px] text-green-600";
            } else {
                feeDisplay.innerText = `${deliveryFee} ‡∏ö‡∏≤‡∏ó`; feeDisplay.className = "text-gray-800";
                if (distanceKm <= 1.5 && foodTotal < 100) {
                    feeDetail.innerText = `(‡∏™‡∏±‡πà‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏µ‡∏Å ${100 - foodTotal}‡∏ö. ‡∏™‡πà‡∏á‡∏ü‡∏£‡∏µ!)`; feeDetail.className = "text-xs text-red-500 font-bold animate-pulse";
                } else if (foodTotal < 200) {
                    feeDetail.innerText = `(‡∏™‡∏±‡πà‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏µ‡∏Å ${200 - foodTotal}‡∏ö. ‡∏™‡πà‡∏á‡∏ü‡∏£‡∏µ)`; feeDetail.className = "text-[10px] text-orange-500";
                } else { feeDetail.innerText = ""; }
            }

            document.getElementById('summary-grand-total').innerText = `${grandTotal} ‡∏ö‡∏≤‡∏ó`;
            
            // ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏° QR Code
            const promptpayNo = "0622467746"; 
            document.getElementById('qr-image').src = `https://promptpay.io/${promptpayNo}/${grandTotal}`;
            document.getElementById('qr-amount-display').innerText = `${grandTotal} ‡∏ö‡∏≤‡∏ó`;
            document.getElementById('cod-amount-display').innerText = `${grandTotal}`;
            
            // üî• ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå COD ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ!
            checkCODEligibility();

            // ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
            showPage('payment');
        }

        function togglePaymentDetail() {
            const method = document.querySelector('input[name="paymentMethod"]:checked').value;
            document.getElementById('payment-transfer-detail').classList.toggle('hidden', method !== 'transfer');
            document.getElementById('payment-cod-detail').classList.toggle('hidden', method !== 'cod');
        }

        async function confirmOrder() {
            const method = document.querySelector('input[name="paymentMethod"]:checked').value;
            const name = document.getElementById('cust-name').value;
            const phone = document.getElementById('cust-phone').value;
            const address = document.getElementById('cust-address').value;
            const landmark = document.getElementById('cust-landmark').value;
            
            // üß† Remember Me: ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏•‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á
            localStorage.setItem('cust_name', name);
            localStorage.setItem('cust_phone', phone);
            localStorage.setItem('cust_address', address);
            
            // üî• NEW: ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏î‡πâ‡∏ß‡∏¢
            localStorage.setItem('cust_lat', userLat);
            localStorage.setItem('cust_lng', userLng);

            let slipBase64 = "";
            if(method === 'transfer') {
                const fileInput = document.getElementById('slip-file');
                if(fileInput.files.length === 0) return Swal.fire({icon: 'warning', text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô'});
                slipBase64 = await toBase64(fileInput.files[0]);
            }

            Swal.fire({ title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå...', text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà ‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤', allowOutsideClick: false, didOpen: () => Swal.showLoading() });

            const orderData = {
                name: name, phone: phone, address: address, landmark: landmark, location: `${userLat},${userLng}`,
                items: cart.map((i, index) => {
                    let detail = `${index + 1}. ${i.name} (x${i.qty})`; // üî• ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡πÑ‡∏õ Line
                    if (i.selectedOptions && i.selectedOptions.length > 0) {
                        detail += i.selectedOptions.map(opt => `\n   ‚îî üî∏ ${opt}`).join(''); 
                    }
                    return detail;
                }).join('\n\n'),
                total: document.getElementById('summary-grand-total').innerText,
                paymentMethod: method, slipImage: slipBase64
            };

            fetch(WEB_APP_URL, {
                method: 'POST', mode: 'no-cors', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(orderData)
            }).then(() => {
                
                // ‚úÖ 1. ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏•‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (History)
                saveOrderToHistory(orderData);
                
                // ‚úÖ 2. ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏õ‡∏∏‡πà‡∏° Tracking ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
                updateTrackingButtonState();

                // ‚úÖ 3. ‡πÅ‡∏™‡∏î‡∏á Popup ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡πÅ‡∏•‡∏∞‡∏õ‡∏∏‡πà‡∏°‡πÑ‡∏õ‡∏î‡∏π‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
                Swal.fire({
                    icon: 'success',
                    title: '‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                    text: '‡∏ó‡∏≤‡∏á‡∏£‡πâ‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏£‡∏±‡∏ö',
                    showCancelButton: true,
                    confirmButtonText: 'üì¶ ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞',
                    confirmButtonColor: '#16a34a',
                    cancelButtonText: '‡∏™‡∏±‡πà‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°',
                    cancelButtonColor: '#6b7280'
                }).then((result) => {
                    cart = []; updateCartUI(); // ‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
                    if (result.isConfirmed) {
                        openTrackingPage(); // ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°
                    } else {
                        showPage('menu'); // ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏™‡∏±‡πà‡∏á‡∏ï‡πà‡∏≠
                    }
                });

            }).catch(err => {
                console.error(err); Swal.fire({ icon: 'error', text: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà' });
            });
        }

        const toBase64 = file => new Promise((resolve, reject) => {
            const reader = new FileReader(); reader.readAsDataURL(file);
            reader.onload = () => resolve(reader.result); reader.onerror = error => reject(error);
        });

        function startBannerAutoSlide() {
            const slider = document.getElementById('banner-slider');
            if (!slider) return;
            
            let scrollAmount = 0;
            setInterval(() => {
                const cardWidth = slider.offsetWidth + 12; 
                scrollAmount += cardWidth;
                if (scrollAmount >= slider.scrollWidth) {
                    scrollAmount = 0;
                    slider.scrollTo({ left: 0, behavior: 'auto' }); 
                } else {
                    slider.scrollTo({ left: scrollAmount, behavior: 'smooth' }); 
                }
            }, 9000); 
        }

        // --- 8. History & Tracking Logic ---

        function saveOrderToHistory(order) {
            let history = JSON.parse(localStorage.getItem('order_history') || "[]");
            const timePart = new Date().toLocaleTimeString('th-TH').replace(/:/g,'');
            const shortId = timePart.slice(-4); 

            const newOrder = {
                id: 'Order #' + shortId, 
                date: new Date().toLocaleDateString('th-TH', {day: 'numeric', month: 'short', hour:'2-digit', minute:'2-digit'}),
                items: order.items.replace(/\n/g, '<br>'),
                total: document.getElementById('summary-grand-total').innerText,
                status: 'üïí ‡∏£‡∏≠‡∏£‡πâ‡∏≤‡∏ô‡∏£‡∏±‡∏ö‡∏¢‡∏≠‡∏î' 
            };
            history.unshift(newOrder); 
            localStorage.setItem('order_history', JSON.stringify(history));
        }

        function updateTrackingButtonState() {
            const history = JSON.parse(localStorage.getItem('order_history') || "[]");
            const btn = document.getElementById('header-tracking-btn');
            
            if (history.length > 0) {
                btn.innerHTML = '<i class="fa-solid fa-clock-rotate-left mr-1"></i> ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠';
            } else {
                btn.innerHTML = '<i class="fa-solid fa-truck-fast mr-1"></i> ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞';
            }
        }

        // üî• ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏î‡∏à‡∏≤‡∏Å Header (‡πÅ‡∏Ñ‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤ ‡πÑ‡∏°‡πà‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö Logic ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)
        function handleTrackingClick() {
            showPage('tracking'); 
        }
        
        // üî• ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà: ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤ Tracking ‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞
        function openTrackingPage() {
            showPage('tracking');
        }

        // ----------------------------------------------------
        // üî•üî•üî• ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡πà‡∏ß‡∏ô Tracking (‡∏•‡∏π‡∏õ‡∏´‡∏≤‡∏¢ + ‡∏ä‡πà‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß) üî•üî•üî•
        // ----------------------------------------------------

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÇ‡∏î‡∏¢ showPage('tracking') ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
        function initTrackingPage() {
            const history = JSON.parse(localStorage.getItem('order_history') || "[]");
            const savedPhone = localStorage.getItem('cust_phone');
            
            // ‚úÖ ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÇ‡∏ä‡∏ß‡πå‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏™‡∏°‡∏≠ (Remove Class hidden)
            document.getElementById('tracking-search-box').classList.remove('hidden');

            if (savedPhone) {
                // ‡∏Å‡∏£‡∏ì‡∏µ‡∏°‡∏µ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏¥‡∏°: ‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÉ‡∏´‡πâ ‡πÅ‡∏•‡∏∞‡∏Å‡∏î‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
                document.getElementById('track-phone').value = savedPhone;
                searchOrder(false); // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å (‡πÇ‡∏ä‡∏ß‡πå Loading)
                
                // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏ö‡∏ö Auto Refresh
                if (trackingInterval) clearInterval(trackingInterval);
                trackingInterval = setInterval(() => {
                    searchOrder(true); // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏ö‡∏ö‡πÄ‡∏á‡∏µ‡∏¢‡∏ö (‡πÑ‡∏°‡πà‡πÇ‡∏ä‡∏ß‡πå Loading)
                }, 10000); 
                
            } else if (history.length > 0) {
                // ‡∏Å‡∏£‡∏ì‡∏µ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏ö‡∏≠‡∏£‡πå ‡πÅ‡∏ï‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á: ‡πÇ‡∏ä‡∏ß‡πå‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÄ‡∏Å‡πà‡∏≤
                renderHistory(history);
            } else {
                // ‡∏Å‡∏£‡∏ì‡∏µ‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏≠‡∏µ‡πà‡∏¢‡∏°: ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏£‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
                document.getElementById('tracking-result').innerHTML = `
                    <div class="text-center text-gray-300 py-10">
                        <i class="fa-solid fa-magnifying-glass text-4xl mb-2"></i>
                        <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</p>
                    </div>`;
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå (Search)
        function searchOrder(isSilent = false) { 
            const phone = document.getElementById('track-phone').value.trim();
            if(phone.length < 9) {
                if(!isSilent) Swal.fire({icon:'warning', title:'‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á'});
                return;
            }

            const resultDiv = document.getElementById('tracking-result');
            
            // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà Silent Mode ‡πÉ‡∏´‡πâ‡∏Ç‡∏∂‡πâ‡∏ô Loading
            if(!isSilent) {
                resultDiv.innerHTML = `
                <div class="text-center py-10 animate-pulse">
                    <i class="fa-solid fa-circle-notch fa-spin text-green-600 text-3xl"></i>
                    <p class="text-gray-500 mt-2">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î...</p>
                </div>`;
            }

            // ‡∏¢‡∏¥‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà Google Apps Script
            fetch(`${WEB_APP_URL}?action=get_customer_orders&phone=${encodeURIComponent(phone)}`) 
            .then(res => res.json())
            .then(data => {
                if(data.orders && data.orders.length > 0) {
                    // ‚úÖ ‡πÄ‡∏à‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
                    renderHistoryFromAdminData(data.orders);
                    
                    // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÑ‡∏ß‡πâ‡∏î‡πâ‡∏ß‡∏¢ (‡πÄ‡∏ú‡∏∑‡πà‡∏≠ User ‡∏û‡∏¥‡∏°‡∏û‡πå‡πÉ‡∏´‡∏°‡πà)
                    localStorage.setItem('cust_phone', phone);
                } else {
                    // ‚ùå ‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô Server
                    if(!isSilent) {
                        // ‡∏•‡∏≠‡∏á‡∏î‡∏π‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á (Backup)
                        checkLocalStorageBackup();
                    }
                }
            })
            .catch(err => {
                console.error("Fetch error:", err);
                if(!isSilent) checkLocalStorageBackup();
            });
        }

        function checkLocalStorageBackup() {
            const history = JSON.parse(localStorage.getItem('order_history') || "[]");
            const resultDiv = document.getElementById('tracking-result');
            
            if(history.length > 0) {
                renderHistory(history);
                resultDiv.insertAdjacentHTML('afterbegin', '<p class="text-center text-xs text-orange-400 mb-2"><i class="fa-solid fa-triangle-exclamation"></i> ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Server ‡πÑ‡∏î‡πâ ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</p>');
            } else {
                resultDiv.innerHTML = '<div class="text-center text-gray-400 py-10"><i class="fa-solid fa-box-open text-4xl mb-2"></i><p>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</p></div>';
            }
        }

        function renderHistoryFromAdminData(serverOrders) {
            const container = document.getElementById('tracking-result');
            
            container.innerHTML = serverOrders.map(order => {
                let statusColor = "text-orange-500 bg-orange-50 border-orange-100";
                let cardBgColor = "bg-white"; 

                if(order.status.includes("‡∏õ‡∏£‡∏∏‡∏á")) {
                    statusColor = "text-blue-600 bg-blue-50 border-blue-100";
                    cardBgColor = "bg-blue-50/30 border-blue-100"; 
                }
                else if(order.status.includes("‡∏™‡πà‡∏á") || order.status.includes("‡πÑ‡∏£‡πÄ‡∏î‡∏≠‡∏£‡πå")) {
                    statusColor = "text-purple-600 bg-purple-50 border-purple-100";
                    cardBgColor = "bg-purple-50/30 border-purple-100"; 
                }
                else if(order.status.includes("‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à")) {
                    statusColor = "text-green-600 bg-green-50 border-green-100";
                    cardBgColor = "bg-green-50/30 border-green-100"; 
                }
                else if(order.status.includes("‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å")) {
                    statusColor = "text-red-600 bg-red-50 border-red-100";
                    cardBgColor = "bg-red-50/30 border-red-100"; 
                } else {
                    cardBgColor = "bg-orange-50/20 border-orange-100"; 
                }

                const displayId = order.shortId || (order.id.includes('-') ? order.id.split('-')[1].slice(-4) : order.id.slice(-4));

                return `
                <div class="${cardBgColor} p-4 rounded-xl border shadow-sm flex flex-col gap-2 relative overflow-hidden transition-all duration-300">
                    <div class="flex justify-between items-start z-10">
                        <div>
                            <span class="bg-white/80 text-gray-600 text-[10px] font-bold px-2 py-1 rounded border border-gray-200 shadow-sm">#${displayId}</span>
                            <div class="text-xs text-gray-500 mt-1 flex items-center gap-1"><i class="fa-regular fa-clock"></i> ${order.time}</div>
                        </div>
                        <span class="${statusColor} font-bold text-xs px-2 py-1 rounded-lg border flex items-center gap-1 shadow-sm">
                            ${getStatusIcon(order.status)} ${order.status}
                        </span>
                    </div>
                    <div class="border-t border-dashed border-gray-200/50 my-2"></div>
                    <div class="text-sm text-gray-700 space-y-1">
                        ${order.items.replace(/\n/g, '<br>')}
                    </div>
                    <div class="flex justify-between items-center mt-3 pt-2 border-t border-gray-200/50">
                        <span class="text-xs text-gray-500">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°</span>
                        <span class="font-bold text-gray-800 text-lg">${order.total}</span>
                    </div>
                </div>
            `}).join('');
        }

        function renderHistory(historyData) {
            const container = document.getElementById('tracking-result');
            container.innerHTML = historyData.map(order => {
                 let statusColor = "text-orange-500 bg-orange-50 border-orange-100";
                 // ... Logic ‡πÄ‡∏î‡∏¥‡∏°
                 return `<div class="bg-white p-4 rounded-xl border border-gray-100 shadow-sm flex flex-col gap-2 relative overflow-hidden">
                    <div class="flex justify-between items-start z-10">
                        <div><span class="bg-gray-100 text-gray-600 text-[10px] font-bold px-2 py-1 rounded border border-gray-200">${order.id}</span><div class="text-xs text-gray-400 mt-1">${order.date}</div></div>
                        <span class="${statusColor} font-bold text-xs px-2 py-1 rounded-lg border flex items-center gap-1">${getStatusIcon(order.status)} ${order.status}</span>
                    </div>
                    <div class="border-t border-dashed border-gray-100 my-2"></div>
                    <div class="text-sm text-gray-600 space-y-1">${order.items}</div>
                    <div class="flex justify-between items-center mt-3 pt-2 border-t border-gray-50"><span class="text-xs text-gray-400">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°</span><span class="font-bold text-gray-800 text-lg">${order.total}</span></div>
                </div>`;
            }).join('');
        }

        function getStatusIcon(status) {
            if(status.includes("‡∏õ‡∏£‡∏∏‡∏á")) return '<i class="fa-solid fa-fire-burner"></i>';
            if(status.includes("‡∏™‡πà‡∏á") || status.includes("‡πÑ‡∏£‡πÄ‡∏î‡∏≠‡∏£‡πå")) return '<i class="fa-solid fa-motorcycle"></i>';
            if(status.includes("‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à")) return '<i class="fa-solid fa-circle-check"></i>';
            if(status.includes("‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å")) return '<i class="fa-solid fa-circle-xmark"></i>';
            return '<i class="fa-regular fa-clock"></i>';
        }

        // --- 9. Payment Helpers (Copy, Download, Check COD) ---

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                Swal.fire({
                    toast: true, position: 'top', icon: 'success', 
                    title: '‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÅ‡∏•‡πâ‡∏ß', showConfirmButton: false, timer: 1000 
                });
            }).catch(err => {
                console.error('Copy failed', err);
            });
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î QR Code
        async function downloadQR() {
            const imgSrc = document.getElementById('qr-image').src;
            if(!imgSrc) return;
            
            try {
                const image = await fetch(imgSrc);
                const imageBlog = await image.blob();
                const imageURL = URL.createObjectURL(imageBlog);

                const link = document.createElement('a');
                link.href = imageURL;
                link.download = 'QR-Payment.png';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            } catch(e) {
                Swal.fire({icon:'error', text:'‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏π‡∏õ‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏Ñ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÅ‡∏ó‡∏ô'});
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå COD (‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏Å‡πà‡∏≤‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)
        function checkCODEligibility() {
            const history = JSON.parse(localStorage.getItem('order_history') || "[]");
            const codRadio = document.getElementById('cod-radio');
            const codLabel = document.getElementById('cod-label');
            const codBox = document.getElementById('cod-box');
            const codWarning = document.getElementById('cod-warning-text');

            if (history.length > 0) {
                // ‚úÖ ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏Å‡πà‡∏≤: ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥
                codRadio.disabled = false;
                codLabel.classList.remove('opacity-50', 'pointer-events-none');
                codBox.classList.remove('bg-gray-100');
                codWarning.classList.add('hidden');
            } else {
                // üîí ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà: ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô + ‡πÇ‡∏ä‡∏ß‡πå‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
                codRadio.disabled = true;
                codLabel.classList.add('opacity-60'); // ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏î‡∏π‡∏à‡∏≤‡∏á‡πÜ
                // ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ‡∏Å‡∏î‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏¥‡∏î‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏•‡πà‡∏≤‡∏á‡∏ô‡∏µ‡πâ
                // codLabel.classList.add('pointer-events-none'); 
                codBox.classList.add('bg-gray-100'); // ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏ó‡∏≤
                codWarning.classList.remove('hidden'); // ‡πÇ‡∏ä‡∏ß‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
            }
        }

        // --- 10. Shop Status UI ---
        function updateShopStatusUI() {
            const badge = document.getElementById('shop-status-badge');
            
            if (isShopOpen()) {
                // ‚úÖ ‡∏£‡πâ‡∏≤‡∏ô‡πÄ‡∏õ‡∏¥‡∏î
                badge.classList.remove('hidden', 'bg-red-500');
                badge.classList.add('bg-green-500');
                badge.innerText = "‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡πâ‡∏≤‡∏ô";
            } else {
                // ‚õî ‡∏£‡πâ‡∏≤‡∏ô‡∏õ‡∏¥‡∏î
                badge.classList.remove('hidden', 'bg-green-500');
                badge.classList.add('bg-red-500');
                badge.innerText = "‡∏õ‡∏¥‡∏î‡∏£‡πâ‡∏≤‡∏ô";
            }
        }
    </script>
</body>
</html>
